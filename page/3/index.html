<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="baidu-site-verification" content="L6Lm9d5Crl"/>
  
  
  
  
  <title>iyua</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="my blog">
<meta property="og:type" content="website">
<meta property="og:title" content="iyua">
<meta property="og:url" content="http://example.com/page/3/index.html">
<meta property="og:site_name" content="iyua">
<meta property="og:description" content="my blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="iyua">
<meta name="twitter:card" content="summary">
  
    <link rel="alternative" href="/atom.xml" title="iyua" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/favicon.png">
  
  
  
<link rel="stylesheet" href="../../cdn.bootcss.com/animate.css/3.5.0/animate.min.css">

  
  
<link rel="stylesheet" href="../../css/style.css">

  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  
    
    
  
  
      <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  
  <!-- 加载特效 -->
    <script src="/js/pace.js"></script>
    <link href="/css/pace/pace-theme-flash.css" rel="stylesheet" />
  <script>
      var yiliaConfig = {
          fancybox: true,
          animate: true,
          isHome: true,
          isPost: false,
          isArchive: false,
          isTag: false,
          isCategory: false,
          open_in_new: false
      }
  </script>
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.3.0"></head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        
<script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>

        <a href="/" class="profilepic">
            
            <img lazy-src="/img/avatar.png" class="js-avatar">
            
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/"></a></h1>
        </hgroup>
        
        
            <form>
                <input type="text" class="st-default-search-input search" id="local-search-input" placeholder="搜索一下" autocomplete="off">
            </form>
            <div id="local-search-result"></div>
        
        
            <script type="text/javascript">
                (function() {
                    'use strict';
                    function getMatchData(keyword, data) {
                        var matchData = [];
                        for(var i =0;i<data.length;i++){
                            if(data[i].title.toLowerCase().indexOf(keyword)>=0) 
                                matchData.push(data[i])
                        }
                        return matchData;
                    }
                    var $input = $('#local-search-input');
                    var $resultContent = $('#local-search-result');
                    $input.keyup(function(){
                        $.ajax({
                            url: '/search.json',
                            dataType: "json",
                            success: function( json ) {
                                var str='<ul class=\"search-result-list\">';                
                                var keyword = $input.val().trim().toLowerCase();
                                $resultContent.innerHTML = "";
                                if ($input.val().trim().length <= 0) {
                                    $resultContent.empty();
                                    $('#switch-area').show();
                                    return;
                                }
                                var results = getMatchData(keyword, json);
                                if(results.length === 0){
                                    $resultContent.empty();
                                    $('#switch-area').show();
                                    return;
                                } 
                                for(var i =0; i<results.length; i++){
                                    str += "<li><a href='"+ results[i].url +"' class='search-result-title'>"+ results[i].title +"</a></li>";
                                }
                                str += "</ul>";
                                $resultContent.empty();
                                $resultContent.append(str);
                                $('#switch-area').hide();
                            }
                        });
                    });
                })();
            </script>
        
        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        
        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a  href="../../index.html">主页</a></li>
                        
                            <li><a  href="../../archives/">所有文章</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fl luogu"  target="_blank" href="../../https:/www.luogu.com.cn/user/321875" title="luogu">luogu</a>
                            
                                <a class="fl codeforces"  target="_blank" href="../../http:/codeforces.com/profile/iyua" title="codeforces">codeforces</a>
                            
                                <a class="fl nowcoder"  target="_blank" href="../../https:/ac.nowcoder.com/acm/contest/profile/118182697" title="nowcoder">nowcoder</a>
                            
                        </ul>
                    </nav>
                </section>
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <a href="../../tags/DP/" style="font-size: 12px;">DP</a> <a href="../../tags/Traning/" style="font-size: 10px;">Traning</a> <a href="../../tags/%E5%8D%9A%E5%BC%88/" style="font-size: 10px;">博弈</a> <a href="../../tags/%E5%9B%BE%E8%AE%BA/" style="font-size: 18px;">图论</a> <a href="../../tags/%E5%AD%97%E7%AC%A6%E4%B8%B2/" style="font-size: 10px;">字符串</a> <a href="../../tags/%E5%B9%B6%E6%9F%A5%E9%9B%86/" style="font-size: 10px;">并查集</a> <a href="../../tags/%E6%95%B0%E5%AD%A6/" style="font-size: 10px;">数学</a> <a href="../../tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 20px;">数据结构</a> <a href="../../tags/%E6%9D%82%E9%A1%B9/" style="font-size: 14px;">杂项</a> <a href="../../tags/%E6%AF%94%E8%B5%9B/" style="font-size: 16px;">比赛</a> <a href="../../tags/%E8%84%91%E5%AD%90%E9%A2%98/" style="font-size: 10px;">脑子题</a>
                    </div>
                </section>
                
                
                
                
                <section class="switch-part switch-part3">
                
                    <div id="js-aboutme">2108507537@qq.com</div>
                </section>
                
            </div>
        </div>
    </header>
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页"></a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                
                    <img lazy-src="/img/avatar.png" class="js-avatar">
                
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页"></a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="../../index.html">主页</a></li>
                
                    <li><a href="../../archives/">所有文章</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                <div class="social">
                    
                        <a class="luogu" target="_blank" href="../../https:/www.luogu.com.cn/user/321875" title="luogu">luogu</a>
                    
                        <a class="codeforces" target="_blank" href="../../http:/codeforces.com/profile/iyua" title="codeforces">codeforces</a>
                    
                        <a class="nowcoder" target="_blank" href="../../https:/ac.nowcoder.com/acm/contest/profile/118182697" title="nowcoder">nowcoder</a>
                    
                </div>
            </nav>
        </header>
    </div>
</nav>
      <div class="body-wrap">
  
    <article id="post-线段树动态开点-离散化" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a  href="../../2021/01/26/%E7%BA%BF%E6%AE%B5%E6%A0%91%E5%8A%A8%E6%80%81%E5%BC%80%E7%82%B9-%E7%A6%BB%E6%95%A3%E5%8C%96/" class="article-date">
      <time datetime="2021-01-26T11:01:17.000Z" itemprop="datePublished">2021-01-26</time>
</a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a  class="article-title" href="../../2021/01/26/%E7%BA%BF%E6%AE%B5%E6%A0%91%E5%8A%A8%E6%80%81%E5%BC%80%E7%82%B9-%E7%A6%BB%E6%95%A3%E5%8C%96/">线段树动态开点 &amp; 离散化</a>
    </h1>
  


      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h6 id="动态开点线段树"><a href="#动态开点线段树" class="headerlink" title="动态开点线段树"></a>动态开点线段树</h6><p>总所周知普通线段树线段树要开四倍空间，然而对于个别空间限制很严格的题目，就不能对于全开四倍空间了，所以就需要用到<strong>动态开点</strong>的思想<br>由于一次询问/修改最多涉及到 $logn$ 个节点的变化，所以我们可以边处理边，把用不到的点都不开出来，需要用的时候再建立节点，和普通线段树的区别在于这里左右儿子不再是二倍和二倍加一，而是不固定的，需要单独记录下来<br>比如这个题<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3313">洛谷P3313</a><br>解法是  树链剖分+动态开点线段树<br>容易想到的是，对于每一个宗教都开一个线段树，然后对于每个地点来在相应的线段树上查询/修改就可以了，然而所有宗教都开一颗线段树的话明显会 $mle$，同时根据一次修改最多涉及$logn$个节点，所以我们可以来动态开点，对于每个宗教开一个根节点 $root[i]$ 之后每次从这个根入手，动态开点就可以了，外层就是基础的树链剖分</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> de(x)   cerr &lt;&lt; <span class="meta-string">&quot;   debug  &quot;</span> &lt;&lt; #x &lt;&lt; <span class="meta-string">&quot;  ==  &quot;</span> &lt;&lt; x &lt;&lt; endl;</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span>  LL;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">1e5</span> + <span class="number">7</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxm = <span class="number">1e4</span> + <span class="number">7</span>;</span><br><span class="line"><span class="keyword">int</span> root[maxm], C[maxn], W[maxn], n, tot = <span class="number">0</span>, tim = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> id[maxn], rk[maxn], dep[maxn], top[maxn], fa[maxn];</span><br><span class="line"><span class="keyword">int</span> siz[maxn], son[maxn];</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; G[maxn];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFS1</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> fr)</span> </span>&#123;</span><br><span class="line">    dep[u] = dep[fr] + <span class="number">1</span>;</span><br><span class="line">    siz[u] = <span class="number">1</span>; son[u] = <span class="number">-1</span>; fa[u] = fr;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G[u].size(); ++ i) &#123;</span><br><span class="line">        <span class="keyword">int</span> v = G[u][i];</span><br><span class="line">        <span class="keyword">if</span>(v == fr) <span class="keyword">continue</span>;</span><br><span class="line">        DFS1(v, u);</span><br><span class="line">        siz[u] += siz[v];</span><br><span class="line">        <span class="keyword">if</span>(son[u] == <span class="number">-1</span> || siz[v] &gt; siz[son[u]]) &#123;</span><br><span class="line">            son[u] = v;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFS2</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> fr)</span> </span>&#123;</span><br><span class="line">    id[u] = ++ tim; rk[tim] = u; top[u] = fr;</span><br><span class="line">    <span class="keyword">if</span>(son[u] == <span class="number">-1</span>) <span class="keyword">return</span> ;</span><br><span class="line">    DFS2(son[u], fr);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G[u].size(); ++ i) &#123;</span><br><span class="line">        <span class="keyword">int</span> v = G[u][i];</span><br><span class="line">        <span class="keyword">if</span>(v == fa[u] || v == son[u]) <span class="keyword">continue</span>;</span><br><span class="line">        DFS2(v, v);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">5e6</span> + <span class="number">7</span>;</span><br><span class="line"><span class="keyword">int</span> node[N], ls[N], rs[N], mx[N];</span><br><span class="line">LL sum[N];</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> md  (l + r &gt;&gt; 1)</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">updata</span><span class="params">(<span class="keyword">int</span>&amp; rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> pos, <span class="keyword">int</span> be)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!rt) &#123;</span><br><span class="line">        rt = ++ tot;</span><br><span class="line">        ls[tot] = rs[tot] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(l == r) &#123;</span><br><span class="line">        mx[rt] = sum[rt] = be;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(pos &lt;= md) updata(ls[rt], l, md, pos, be);</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        updata(rs[rt], md + <span class="number">1</span>, r, pos, be);</span><br><span class="line">    &#125;</span><br><span class="line">    mx[rt] = max(mx[ls[rt]], mx[rs[rt]]);</span><br><span class="line">    sum[rt] = sum[ls[rt]] + sum[rs[rt]];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">querymx</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> L, <span class="keyword">int</span> R)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l == L &amp;&amp; r == R) <span class="keyword">return</span> mx[rt];</span><br><span class="line">    <span class="keyword">if</span>(R &lt;= md) <span class="keyword">return</span> querymx(ls[rt], l, md, L, R);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(L &gt;= md + <span class="number">1</span>) <span class="keyword">return</span> querymx(rs[rt], md + <span class="number">1</span>, r, L, R);</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> max(querymx(ls[rt], l, md, L, md), querymx(rs[rt], md + <span class="number">1</span>, r, md + <span class="number">1</span>, R));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">LL <span class="title">querysum</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> L, <span class="keyword">int</span> R)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l == L &amp;&amp; r == R) <span class="keyword">return</span> sum[rt];</span><br><span class="line">    <span class="keyword">if</span>(R &lt;= md) <span class="keyword">return</span> querysum(ls[rt], l, md, L, R);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(L &gt;= md + <span class="number">1</span>) <span class="keyword">return</span> querysum(rs[rt], md + <span class="number">1</span>, r, L, R);</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> querysum(ls[rt], l, md, L, md) + querysum(rs[rt], md + <span class="number">1</span>, r, md + <span class="number">1</span>, R);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">LL <span class="title">solve</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">bool</span> flag = <span class="literal">true</span>)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> c = C[u];</span><br><span class="line">    LL res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(top[u] != top[v]) &#123;</span><br><span class="line">        <span class="keyword">if</span>(dep[top[u]] &lt; dep[top[v]]) swap(u, v);</span><br><span class="line">        <span class="keyword">if</span>(flag) &#123;</span><br><span class="line">            res += querysum(root[c], <span class="number">1</span>, n, id[top[u]], id[u]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res = max(res, <span class="number">1l</span>l * querymx(root[c], <span class="number">1</span>, n, id[top[u]], id[u]));</span><br><span class="line">        &#125;</span><br><span class="line">        u = fa[top[u]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(id[u] &gt; id[v]) swap(u, v);</span><br><span class="line">    <span class="keyword">if</span>(flag) &#123;</span><br><span class="line">        res += querysum(root[c], <span class="number">1</span>, n, id[u], id[v]);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res = max(res, <span class="number">1l</span>l * querymx(root[c], <span class="number">1</span>, n, id[u], id[v]));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> Q; <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;n, &amp;Q);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++ i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;W[i], &amp;C[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; ++ i) &#123;</span><br><span class="line">        <span class="keyword">int</span> u, v;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;u, &amp;v);</span><br><span class="line">        G[u].push_back(v);</span><br><span class="line">        G[v].push_back(u);</span><br><span class="line">    &#125;</span><br><span class="line">    DFS1(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    DFS2(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++ i) &#123;</span><br><span class="line">        updata(root[C[i]], <span class="number">1</span>, n, id[i], W[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(Q --) &#123;</span><br><span class="line">        <span class="keyword">char</span> op[<span class="number">10</span>];</span><br><span class="line">        <span class="keyword">int</span> x, y;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s %d %d&quot;</span>, op, &amp;x, &amp;y);</span><br><span class="line">        <span class="keyword">if</span>(op[<span class="number">1</span>] == <span class="string">&#x27;C&#x27;</span>) &#123;</span><br><span class="line">            updata(root[C[x]], <span class="number">1</span>, n, id[x], <span class="number">0</span>);</span><br><span class="line">            C[x] = y;</span><br><span class="line">            updata(root[C[x]], <span class="number">1</span>, n, id[x], W[x]);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(op[<span class="number">1</span>] == <span class="string">&#x27;W&#x27;</span>) &#123;</span><br><span class="line">            updata(root[C[x]], <span class="number">1</span>, n, id[x], y);</span><br><span class="line">            W[x] = y;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(op[<span class="number">1</span>] == <span class="string">&#x27;S&#x27;</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, solve(x, y));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, solve(x, y, <span class="literal">false</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifdef</span> iyua</span></span><br><span class="line">        system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span> </span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="权值线段树"><a href="#权值线段树" class="headerlink" title="权值线段树"></a>权值线段树</h6><p>权值线段树不是依靠下标建立的，而是按每个权值当成叶子节点进行建立的一种线段树，可以处理一些简单的平衡树问题和逆序对之类的问题，给出 $splay$ 模板题的权值线段树写法<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3369">洛谷P3369</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> de(x)   cerr &lt;&lt; <span class="meta-string">&quot;  debug  &quot;</span> &lt;&lt; #x &lt;&lt; <span class="meta-string">&quot;  ==  &quot;</span> &lt;&lt; x &lt;&lt; endl;</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span>  LL;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">1e5</span> + <span class="number">7</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">READ</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> op, v;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">vector</span>&lt;READ&gt; V;</span><br><span class="line"><span class="keyword">int</span> a[maxn], n, len;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ls  (rt &lt;&lt; 1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rs  (rt &lt;&lt; 1|1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> md  (l + r &gt;&gt; 1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lson    ls, l, md</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rson    rs, md + 1, r</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SegTree</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> l, r, cnt;</span><br><span class="line">&#125; Tree[maxn &lt;&lt; <span class="number">2</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">    Tree[rt] = (SegTree) &#123;l, r, <span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">if</span>(l != r) &#123;</span><br><span class="line">        build(lson);</span><br><span class="line">        build(rson);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Insert</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> pos, <span class="keyword">int</span> tag)</span> </span>&#123;</span><br><span class="line">    Tree[rt].cnt += tag;</span><br><span class="line">    <span class="keyword">int</span> l = Tree[rt].l, r = Tree[rt].r;</span><br><span class="line">    <span class="keyword">if</span>(l == r) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="keyword">if</span>(pos &lt;= md) Insert(ls, pos, tag);</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        Insert(rs, pos, tag);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Getrak</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> pos)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> l = Tree[rt].l, r = Tree[rt].r;</span><br><span class="line">    <span class="keyword">if</span>(pos &lt; l) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(l == r) &#123;</span><br><span class="line">        <span class="keyword">return</span> Tree[rt].cnt;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(pos &lt;= md) <span class="keyword">return</span> Getrak(ls, pos);</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Tree[ls].cnt + Getrak(rs, pos);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">kth</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> l = Tree[rt].l, r = Tree[rt].r;</span><br><span class="line">    <span class="keyword">if</span>(l == r) <span class="keyword">return</span> a[l];</span><br><span class="line">    <span class="keyword">int</span> cnt = Tree[ls].cnt;</span><br><span class="line">    <span class="keyword">if</span>(cnt &gt;= k) <span class="keyword">return</span> kth(ls, k);</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> kth(rs, k - cnt);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    V.resize(n);</span><br><span class="line">    len = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++ i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;V[i].op, &amp;V[i].v);</span><br><span class="line">        <span class="keyword">if</span>(V[i].op != <span class="number">4</span>) &#123;</span><br><span class="line">            a[++ len] = V[i].v;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    sort(a + <span class="number">1</span>, a + len + <span class="number">1</span>);</span><br><span class="line">    len = unique(a + <span class="number">1</span>, a + len + <span class="number">1</span>) - a - <span class="number">1</span>;</span><br><span class="line">    build(<span class="number">1</span>, <span class="number">1</span>, len);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span>&amp;x : V) &#123;</span><br><span class="line">        <span class="keyword">int</span> op = x.op, v = x.v, id;</span><br><span class="line">        <span class="keyword">if</span>(op != <span class="number">4</span>) &#123;</span><br><span class="line">            id = lower_bound(a + <span class="number">1</span>, a + len + <span class="number">1</span>, v) - a;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(op == <span class="number">1</span>) &#123;</span><br><span class="line">            Insert(<span class="number">1</span>, id, <span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(op == <span class="number">2</span>) &#123;</span><br><span class="line">            Insert(<span class="number">1</span>, id, <span class="number">-1</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(op == <span class="number">3</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, Getrak(<span class="number">1</span>, id - <span class="number">1</span>) + <span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(op == <span class="number">4</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, kth(<span class="number">1</span>, v));</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(op == <span class="number">5</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, kth(<span class="number">1</span>, Getrak(<span class="number">1</span>, id - <span class="number">1</span>)));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, kth(<span class="number">1</span>, Getrak(<span class="number">1</span>, id) + <span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifdef</span> iyua</span></span><br><span class="line">        system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span> </span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="权值线段树动态开点"><a href="#权值线段树动态开点" class="headerlink" title="权值线段树动态开点"></a>权值线段树动态开点</h6><p>那么同理，我们能写出普通线段树动态开点，那么对于权值线段树也一定可以动态开点，大体思路是一致的，这里传值用权值不用下标就可以了，给出模板题<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/CF915E">CF915E</a><br>这个题空间卡的太狠了。。。我把 $sum$ 从 $long long$ 改成 $int$ 才卡过去</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> de(x)   cerr &lt;&lt; <span class="meta-string">&quot;   debug  &quot;</span> &lt;&lt; #x &lt;&lt; <span class="meta-string">&quot;  ==  &quot;</span> &lt;&lt; x &lt;&lt; endl;</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span>  LL;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">3e5</span> + <span class="number">7</span>;</span><br><span class="line"><span class="keyword">int</span> top = <span class="number">0</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ls(x)   Tree[x].l</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rs(x)   Tree[x].r</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sum(x)  Tree[x].sum</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SegTree</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> l, r, lazy;</span><br><span class="line">    <span class="keyword">int</span> sum;</span><br><span class="line">&#125; Tree[maxn * <span class="number">55</span>];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">push_down</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(Tree[rt].lazy == <span class="number">-1</span>) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="keyword">int</span> md = l + r &gt;&gt; <span class="number">1</span>, tag = Tree[rt].lazy;</span><br><span class="line">    <span class="keyword">if</span>(!ls(rt)) &#123;</span><br><span class="line">        ls(rt) = ++ top;</span><br><span class="line">        <span class="comment">// assert(top &lt; maxn * 35);</span></span><br><span class="line">        Tree[top] = (SegTree) &#123;<span class="number">0</span>, <span class="number">0</span>, tag, <span class="number">1l</span>l * (md - l + <span class="number">1</span>) * tag&#125;;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        Tree[ls(rt)].lazy = tag;</span><br><span class="line">        Tree[ls(rt)].sum = <span class="number">1l</span>l * (md - l + <span class="number">1</span>) * tag;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!rs(rt)) &#123;</span><br><span class="line">        rs(rt) = ++ top;</span><br><span class="line">        <span class="comment">// assert(top &lt; maxn * 35);</span></span><br><span class="line">        Tree[top] = (SegTree) &#123;<span class="number">0</span>, <span class="number">0</span>, tag, <span class="number">1l</span>l * (r - md) * tag&#125;;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        Tree[rs(rt)].lazy = tag;</span><br><span class="line">        Tree[rs(rt)].sum = <span class="number">1l</span>l * (r - md) * tag;</span><br><span class="line">    &#125;</span><br><span class="line">    Tree[rt].lazy = <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">push_up</span><span class="params">(<span class="keyword">int</span> rt)</span> </span>&#123;</span><br><span class="line">    sum(rt) = sum(ls(rt)) + sum(rs(rt));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Insert</span><span class="params">(<span class="keyword">int</span>&amp; rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">int</span> tag)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!rt) &#123;</span><br><span class="line">        rt = ++ top;</span><br><span class="line">        <span class="comment">// assert(top &lt; maxn * 35);</span></span><br><span class="line">        Tree[top] = (SegTree) &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">-1</span>, <span class="number">0</span>&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(l == L &amp;&amp; r == R) &#123;</span><br><span class="line">        Tree[rt].sum = <span class="number">1l</span>l * (r - l + <span class="number">1</span>) * tag;</span><br><span class="line">        Tree[rt].lazy = tag;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    push_down(rt, l, r);</span><br><span class="line">    <span class="keyword">int</span> md = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(R &lt;= md) Insert(ls(rt), l, md, L, R, tag);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(L &gt;= md + <span class="number">1</span>) Insert(rs(rt), md + <span class="number">1</span>, r, L, R, tag);</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        Insert(ls(rt), l, md, L, md, tag);</span><br><span class="line">        Insert(rs(rt), md + <span class="number">1</span>, r, md + <span class="number">1</span>, R, tag);</span><br><span class="line">    &#125;</span><br><span class="line">    push_up(rt);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> root = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> n, Q; <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;n, &amp;Q);</span><br><span class="line">    Insert(root, <span class="number">1</span>, n, <span class="number">1</span>, n, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">while</span>(Q --) &#123;</span><br><span class="line">        <span class="keyword">int</span> op, l, r; <span class="built_in">scanf</span>(<span class="string">&quot;%d %d %d&quot;</span>, &amp;l, &amp;r, &amp;op);</span><br><span class="line">        <span class="keyword">if</span>(op == <span class="number">1</span>) &#123;</span><br><span class="line">            Insert(root, <span class="number">1</span>, n, l, r, <span class="number">0</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Insert(root, <span class="number">1</span>, n, l, r, <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, Tree[root].sum);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifdef</span> iyua</span></span><br><span class="line">        system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span> </span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="线段树离散化"><a href="#线段树离散化" class="headerlink" title="线段树离散化"></a>线段树离散化</h6><p>对于上述说的动态开点权值线段树，其实也可以离散化后建立普通线段树来写，只不过线段树离散化相对于普通线段树最大的区别在于，这里每个节点的 $l$, $r$ 是一个左闭右开区间， 然后两点间的权值需要靠离散化后的数组来求出，比如我写过的 <a target="_blank" rel="noopener" href="http://iyua.top/2021/01/15/2019%E7%89%9B%E5%AE%A2%E5%9B%BD%E5%BA%86day3-E-Grid/">这篇博客</a><br>同时给出上面那题的离散化写法<br><strong>注意离散化后点数是不是变成了二倍，这样就是要开 maxn 八倍空间！！</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> de(x)   cerr &lt;&lt; <span class="meta-string">&quot;   debug  &quot;</span> &lt;&lt; #x &lt;&lt; <span class="meta-string">&quot;  ==  &quot;</span> &lt;&lt; x &lt;&lt; endl;</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span>  LL;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">3e5</span> + <span class="number">7</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxm = <span class="number">1e4</span> + <span class="number">7</span>;</span><br><span class="line"><span class="keyword">int</span> a[maxn &lt;&lt; <span class="number">1</span>], n, len;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> l, r, k;</span><br><span class="line">&#125;cup[maxn];</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; G[maxn];</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ls  (rt &lt;&lt; 1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rs  (rt &lt;&lt; 1|1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> md  (l + r &gt;&gt; 1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Len(x)  (a[Tree[x].r] - a[Tree[x].l])</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SegTree</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> l, r, sum, tag;</span><br><span class="line">&#125; Tree[maxn &lt;&lt; <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">push_up</span><span class="params">(<span class="keyword">int</span> rt)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> l = Tree[rt].l, r = Tree[rt].r;</span><br><span class="line">    Tree[rt].sum = Tree[ls].sum + Tree[rs].sum;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">push_down</span><span class="params">(<span class="keyword">int</span> rt)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> l = Tree[rt].l, r = Tree[rt].r;</span><br><span class="line">    <span class="keyword">if</span>(Tree[rt].tag == <span class="number">-1</span>) <span class="keyword">return</span> ;</span><br><span class="line">    Tree[ls].sum = Len(ls) * Tree[rt].tag;</span><br><span class="line">    Tree[rs].sum = Len(rs) * Tree[rt].tag;</span><br><span class="line">    Tree[ls].tag = Tree[rs].tag = Tree[rt].tag;</span><br><span class="line">    Tree[rt].tag = <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">    Tree[rt] = (SegTree) &#123;l, r, <span class="number">0</span>, <span class="number">-1</span>&#125;;</span><br><span class="line">    <span class="keyword">if</span>(l + <span class="number">1</span> == r) &#123;</span><br><span class="line">        Tree[rt].sum = Len(rt);</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    build(ls, l, md);</span><br><span class="line">    build(rs, md, r);</span><br><span class="line">    push_up(rt);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">updata</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">int</span> tag)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> l = Tree[rt].l, r = Tree[rt].r;</span><br><span class="line">    <span class="keyword">if</span>(l == L &amp;&amp; r == R) &#123;</span><br><span class="line">        Tree[rt].sum = (a[r] - a[l]) * tag;</span><br><span class="line">        Tree[rt].tag = tag;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    push_down(rt);</span><br><span class="line">    <span class="keyword">if</span>(R &lt;= md) updata(ls, L, R, tag);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(L &gt;= md) updata(rs, L, R, tag);</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        updata(ls, L, md, tag);</span><br><span class="line">        updata(rs, md, R, tag);</span><br><span class="line">    &#125;</span><br><span class="line">    push_up(rt);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> N, Q;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;N, &amp;Q);</span><br><span class="line">    len = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= Q; ++ i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d %d %d&quot;</span>, &amp;cup[i].l, &amp;cup[i].r, &amp;cup[i].k);</span><br><span class="line">        ++ cup[i].r;</span><br><span class="line">        a[++ len] = cup[i].l;</span><br><span class="line">        a[++ len] = cup[i].r;</span><br><span class="line">        -- cup[i].k;</span><br><span class="line">    &#125;</span><br><span class="line">    a[++ len] = <span class="number">1</span>;</span><br><span class="line">    a[++ len] = N + <span class="number">1</span>;</span><br><span class="line">    sort(a + <span class="number">1</span>, a + len + <span class="number">1</span>);</span><br><span class="line">    len = unique(a + <span class="number">1</span>, a + len + <span class="number">1</span>) - a - <span class="number">1</span>;</span><br><span class="line">    build(<span class="number">1</span>, <span class="number">1</span>, len);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= Q; ++ i) &#123;</span><br><span class="line">        <span class="keyword">int</span> l = lower_bound(a + <span class="number">1</span>, a + len + <span class="number">1</span>, cup[i].l) - a;</span><br><span class="line">        <span class="keyword">int</span> r = lower_bound(a + <span class="number">1</span>, a + len + <span class="number">1</span>, cup[i].r) - a;</span><br><span class="line">        updata(<span class="number">1</span>, l, r, cup[i].k);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, Tree[<span class="number">1</span>].sum);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifdef</span> iyua</span></span><br><span class="line">        system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span> </span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" rel="tag">数据结构</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
    <article id="post-左偏树" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a  href="../../2021/01/25/%E5%B7%A6%E5%81%8F%E6%A0%91/" class="article-date">
      <time datetime="2021-01-25T12:36:45.000Z" itemprop="datePublished">2021-01-25</time>
</a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a  class="article-title" href="../../2021/01/25/%E5%B7%A6%E5%81%8F%E6%A0%91/">左偏树</a>
    </h1>
  


      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>一个，相当实用的冷门数据结构，主要是快速合并两个优先队列（暴力 $O(n)$ 当然不可）<br>啥？ 你说 $pbds$…可是不一定所有平台都支持这玩意，所以还是手写吧<br>建立左偏树很简单，畸形一些，靠左偏，合并时从右边合并（其实反过来也一样），然后就是比较灵活，注意在关于$Merge$ 函数合并时想清楚 $fa$ 数组怎么写。。<br>给出模板题<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3377">洛谷P3377</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> de(x)   cerr &lt;&lt; <span class="meta-string">&quot;  debug  &quot;</span> &lt;&lt; #x &lt;&lt; <span class="meta-string">&quot;  ==  &quot;</span> &lt;&lt; x &lt;&lt; endl;</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span>  LL;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">1e5</span> + <span class="number">7</span>;</span><br><span class="line"><span class="keyword">int</span> heap[maxn], fa[maxn], ls[maxn], rs[maxn], dis[maxn], n, m;</span><br><span class="line"><span class="keyword">bool</span> del[maxn];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">seek</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x == fa[x] ? x : (fa[x] = seek(fa[x]));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Merge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!u || !v) <span class="keyword">return</span> u + v;</span><br><span class="line">    <span class="keyword">if</span>(heap[u] == heap[v] ? u &gt; v : heap[u] &gt; heap[v]) &#123;</span><br><span class="line">        swap(u, v);</span><br><span class="line">    &#125;</span><br><span class="line">    rs[u] = Merge(rs[u], v);</span><br><span class="line">    dis[u] = dis[rs[u]] + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(dis[ls[u]] &lt; dis[rs[u]]) swap(ls[u], rs[u]);</span><br><span class="line">    fa[ls[u]] = fa[rs[u]] = fa[u] = u;</span><br><span class="line">    <span class="keyword">return</span> u;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pop</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">    del[u] = <span class="literal">true</span>;</span><br><span class="line">    fa[ls[u]] = ls[u];</span><br><span class="line">    fa[rs[u]] = rs[u];</span><br><span class="line">    fa[u] = fa[ls[u]] = fa[rs[u]] = Merge(ls[u], rs[u]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++ i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, heap + i);</span><br><span class="line">        fa[i] = i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(m --) &#123;</span><br><span class="line">        <span class="keyword">int</span> op, l, r;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;op, &amp;l);</span><br><span class="line">        <span class="keyword">if</span>(op == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;r);</span><br><span class="line">            <span class="keyword">if</span>(del[l] || del[r]) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">int</span> fl = seek(l), fr = seek(r);</span><br><span class="line">            <span class="keyword">if</span>(fl == fr) <span class="keyword">continue</span>;</span><br><span class="line">            fa[fl] = fa[fr] = Merge(fl, fr);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(del[l]) &#123;</span><br><span class="line">                <span class="built_in">puts</span>(<span class="string">&quot;-1&quot;</span>);</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">int</span> fl = seek(l);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, heap[fl]);</span><br><span class="line">            pop(fl);</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifdef</span> iyua</span></span><br><span class="line">        system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span> </span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P2713">洛谷P2713</a><br>和上述一摸一样<br><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P1552">洛谷P1552</a><br>很明显有个暴力写法，$O(n^2)$ 枚举每个子树的所有儿子<br>但是肯定超时，考虑如何快速求出一个子树里面最小的不超过某个数值的儿子的个数，我们可以左偏树维护一个大根堆，同时记录堆内元素个数和元素之和，只要元素之和大于限制值，就暴力 $pop$ , 这样贪心明显正确，之后把儿子的堆合并到父亲节点就可以了</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> de(x)   cerr &lt;&lt; <span class="meta-string">&quot;  debug  &quot;</span> &lt;&lt; #x &lt;&lt; <span class="meta-string">&quot;  ==  &quot;</span> &lt;&lt; x &lt;&lt; endl;</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span>  LL;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">1e5</span> + <span class="number">7</span>;</span><br><span class="line"><span class="keyword">int</span> cnt[maxn], fa[maxn], n;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">seek</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x == fa[x] ? x : (fa[x] = seek(fa[x]));</span><br><span class="line">&#125;</span><br><span class="line">LL heap[maxn], tot[maxn], sum, C[maxn], L[maxn], res = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> ls[maxn], rs[maxn], dis[maxn];</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; G[maxn];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Merge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!u || !v) <span class="keyword">return</span> u + v;</span><br><span class="line">    <span class="keyword">if</span>(heap[u] &lt; heap[v]) swap(u, v);</span><br><span class="line">    rs[u] = Merge(rs[u], v);</span><br><span class="line">    <span class="keyword">if</span>(dis[ls[u]] &lt; dis[rs[u]]) swap(ls[u], rs[u]);</span><br><span class="line">    dis[u] = dis[rs[u]] + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> u;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pop</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">    fa[ls[u]] = ls[u];</span><br><span class="line">    fa[rs[u]] = rs[u];</span><br><span class="line">    LL tmp = tot[u] - heap[u], p = cnt[u] - <span class="number">1</span>;</span><br><span class="line">    fa[u] = Merge(ls[u], rs[u]);</span><br><span class="line">    tot[fa[u]] = tmp;</span><br><span class="line">    cnt[fa[u]] = p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFS</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> fu = seek(u);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G[u].size(); ++ i) &#123;</span><br><span class="line">        <span class="keyword">int</span> v = G[u][i];</span><br><span class="line">        DFS(v);</span><br><span class="line">        <span class="keyword">int</span> fv = seek(v);</span><br><span class="line">        <span class="keyword">int</span> tmp1 = cnt[fu] + cnt[fv];</span><br><span class="line">        LL tmp2 = tot[fu] + tot[fv];</span><br><span class="line">        fu = fa[u] = Merge(fu, fv);</span><br><span class="line">        cnt[fu] = tmp1;</span><br><span class="line">        tot[fu] = tmp2;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">while</span>(tot[fu] &gt; sum) &#123;</span><br><span class="line">        pop(fu);</span><br><span class="line">        fu = fa[u] = seek(fu);</span><br><span class="line">    &#125;</span><br><span class="line">    res = max(res, <span class="number">1l</span>l * L[u] * cnt[fu]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    dis[<span class="number">0</span>] = <span class="number">-1</span>;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %lld&quot;</span>, &amp;n, &amp;sum);</span><br><span class="line">    <span class="keyword">int</span> root;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++ i) &#123;</span><br><span class="line">        fa[i] = i;</span><br><span class="line">        cnt[i] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> a; <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;a);</span><br><span class="line">        <span class="keyword">if</span>(a) &#123;</span><br><span class="line">            G[a].push_back(i);</span><br><span class="line">        &#125; <span class="keyword">else</span> root = i;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%lld %lld&quot;</span>, &amp;C[i], &amp;L[i]);</span><br><span class="line">        heap[i] = C[i];</span><br><span class="line">        tot[i] = C[i];</span><br><span class="line">    &#125;</span><br><span class="line">    DFS(root);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, res);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifdef</span> iyua</span></span><br><span class="line">        system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span> </span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P1456">洛谷P1456</a><br>和模板题差不多啊，只不过这里的删除改成了削弱操作，那就先分离，改变值，再合并就可以了<br>注意细节</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> de(x)   cerr &lt;&lt; <span class="meta-string">&quot;  debug  &quot;</span> &lt;&lt; #x &lt;&lt; <span class="meta-string">&quot;  ==  &quot;</span> &lt;&lt; x &lt;&lt; endl;</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span>  LL;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">1e5</span> + <span class="number">7</span>;</span><br><span class="line"><span class="keyword">int</span> fa[maxn], dis[maxn], ls[maxn], rs[maxn], val[maxn], n;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">seek</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x == fa[x] ? x : (fa[x] = seek(fa[x]));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    dis[<span class="number">0</span>] = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n; ++ i) &#123;</span><br><span class="line">        fa[i] = i;</span><br><span class="line">        ls[i] = rs[i] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Merge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!u || !v) <span class="keyword">return</span> u | v;</span><br><span class="line">    <span class="keyword">if</span>(val[u] &lt; val[v]) swap(u, v);</span><br><span class="line">    rs[u] = Merge(rs[u], v);</span><br><span class="line">    <span class="keyword">if</span>(dis[ls[u]] &lt; dis[rs[u]]) swap(ls[u], rs[u]);</span><br><span class="line">    dis[u] = dis[rs[u]] + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> u;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">damage</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    fa[ls[x]] = ls[x];</span><br><span class="line">    fa[rs[x]] = rs[x];</span><br><span class="line">    <span class="keyword">int</span> a = ls[x], b = rs[x];</span><br><span class="line">    ls[x] = rs[x] = <span class="number">0</span>;</span><br><span class="line">    val[x] /= <span class="number">2</span>;</span><br><span class="line">    fa[a] = fa[x] = Merge(a, fa[x]);</span><br><span class="line">    fa[a] = fa[b] = fa[x] = Merge(b, fa[x]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(~<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n)) &#123;</span><br><span class="line">        clear();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++ i) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, val + i);</span><br><span class="line">        <span class="keyword">int</span> m; <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;m);</span><br><span class="line">        <span class="keyword">while</span>(m --) &#123;</span><br><span class="line">            <span class="keyword">int</span> u, v;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;u, &amp;v);</span><br><span class="line">            <span class="keyword">int</span> fu = seek(u), fv = seek(v);</span><br><span class="line">            <span class="keyword">if</span>(fu == fv) &#123;</span><br><span class="line">                <span class="built_in">puts</span>(<span class="string">&quot;-1&quot;</span>);</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            damage(fu);</span><br><span class="line">            damage(fv);</span><br><span class="line">            fu = seek(fu);</span><br><span class="line">            fv = seek(fv);</span><br><span class="line">            fa[fv] = fa[fu] = Merge(fu, fv);</span><br><span class="line">            <span class="comment">// for (int i = 1; i &lt;= n; ++ i) &#123;</span></span><br><span class="line">            <span class="comment">//     printf(&quot;%d %d\n&quot;, seek(i), val[i]);</span></span><br><span class="line">            <span class="comment">// &#125;</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, val[seek(fu)]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifdef</span> iyua</span></span><br><span class="line">        system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span> </span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" rel="tag">数据结构</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
    <article id="post-对顶堆" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a  href="../../2021/01/25/%E5%AF%B9%E9%A1%B6%E5%A0%86/" class="article-date">
      <time datetime="2021-01-25T12:31:21.000Z" itemprop="datePublished">2021-01-25</time>
</a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a  class="article-title" href="../../2021/01/25/%E5%AF%B9%E9%A1%B6%E5%A0%86/">对顶堆</a>
    </h1>
  


      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P1168">洛谷P1168</a><br>学别的东西遇到的前置知识…一看是绿题…又一看只会权值线段树写法。。。开始迷惑这为啥是绿题…看了题解才发现有一个小 $trick$  用两个优先队列来维护中位数  太妙了<br>我们建立一个大根堆，一个小根堆<br>保证大根堆小根堆要么大小一致，要么相比之下大根堆比小根堆少一个元素<br>同时满足大根堆所有元素都小于等于小根堆所有元素，即大根堆堆顶小于等于小根堆队顶<br>这样，小根堆堆顶就是要求的中位数，（显然）</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> de(x)   cerr &lt;&lt; <span class="meta-string">&quot;  debug  &quot;</span> &lt;&lt; #x &lt;&lt; <span class="meta-string">&quot;  ==  &quot;</span> &lt;&lt; x &lt;&lt; endl;</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span>  LL;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">1e5</span> + <span class="number">7</span>;</span><br><span class="line"><span class="built_in">priority_queue</span>&lt;<span class="keyword">int</span>, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;, less&lt;<span class="keyword">int</span>&gt; &gt; Q1; <span class="comment">// big</span></span><br><span class="line"><span class="built_in">priority_queue</span>&lt;<span class="keyword">int</span>, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;, greater&lt;<span class="keyword">int</span>&gt; &gt; Q2; <span class="comment">// small</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n; <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++ i) &#123;</span><br><span class="line">        <span class="keyword">int</span> x; <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;x);</span><br><span class="line">        <span class="keyword">if</span>(Q1.empty() || x &lt;= Q1.top()) Q1.push(x);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            Q2.push(x);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(Q1.size() &amp;&amp; Q2.size() &amp;&amp; Q1.top() &gt; Q2.top()) &#123;</span><br><span class="line">                <span class="keyword">int</span> u = Q1.top(), v = Q2.top();</span><br><span class="line">                Q1.pop(); Q1.push(v);</span><br><span class="line">                Q2.pop(); Q2.push(u);</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(Q1.size() != Q2.size() &amp;&amp; Q1.size() + <span class="number">1</span> != Q2.size()) &#123;</span><br><span class="line">            <span class="keyword">if</span>(Q1.size() &gt; Q2.size()) &#123;</span><br><span class="line">                Q2.push(Q1.top());</span><br><span class="line">                Q1.pop();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                Q1.push(Q2.top());</span><br><span class="line">                Q2.pop();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(i &amp; <span class="number">1</span>)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, Q2.top());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifdef</span> iyua</span></span><br><span class="line">        system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span> </span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/%E6%9D%82%E9%A1%B9/" rel="tag">杂项</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
    <article id="post-E-Gerald-and-Giant-Chess" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a  href="../../2021/01/24/E-Gerald-and-Giant-Chess/" class="article-date">
      <time datetime="2021-01-24T14:34:03.000Z" itemprop="datePublished">2021-01-24</time>
</a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a  class="article-title" href="../../2021/01/24/E-Gerald-and-Giant-Chess/">E. Gerald and Giant Chess</a>
    </h1>
  


      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p><a target="_blank" rel="noopener" href="https://codeforces.ml/contest/560/problem/E">传送门</a><br>对于小数据范围，直接利用 $dp[x][y] = dp[x - 1][y] + dp[x][y - 1]$ 这个 $DP$ 转移方程就可以很轻易求出来，对于有障碍的格子，直接不取就好了<br>再来考虑大范围，开不下二维数组的情况<br>首先，由高中数学可知，在没有障碍的情况下，从左上 $(1, 1)$ 到 右下 $(n, m)$ 的合法路径数为 $C_{n + m - 2}^{n - 1}$, 因为步数为 $n + m - 2$ 其中 $n - 1$ 步为向下走，所以这个组合数就是答案<br>那么如果我们能将原问题转换为<strong>若干个无障碍地子问题容斥</strong>出来的结果就可以用这个式子来求了<br>考虑 $DP$， 用 $DP[i]$ 代表不经过其他障碍到达第 $i$ 个障碍的方案数，把重点置为最后一个障碍，那么 $DP[n]$ 就是答案<br>所以我们以 $x$ 为第一关键字，$y$为第二关键字来排序，$dp[1]$ 特判，然后暴力$n^2$ 更新 $DP$ 数组就可以了，用每个障碍的排列数减去它前面的每个障碍的方案数乘与这俩障碍之间的排列</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> de(x)   cerr &lt;&lt; <span class="meta-string">&quot;  debug  &quot;</span> &lt;&lt; #x &lt;&lt; <span class="meta-string">&quot;  ==  &quot;</span> &lt;&lt; x &lt;&lt; endl;</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span>  LL;</span><br><span class="line"><span class="keyword">const</span> LL mod = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">2e3</span> + <span class="number">7</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxm = <span class="number">2e5</span> + <span class="number">7</span>;</span><br><span class="line"><span class="keyword">int</span> fac[maxm], DP[maxn];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    fac[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; maxm; ++ i) &#123;</span><br><span class="line">        fac[i] = <span class="number">1l</span>l * fac[i - <span class="number">1</span>] * i % mod;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">qpow</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> res = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(n) &#123;</span><br><span class="line">        <span class="keyword">if</span>(n &amp; <span class="number">1</span>) res = <span class="number">1l</span>l * res * x % mod;</span><br><span class="line">        n &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">        x = <span class="number">1l</span>l * x * x % mod;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="built_in">pair</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; &gt; V;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">C</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// if(a &lt;= 0 || a &lt; b || b &lt; 0) return 0;</span></span><br><span class="line">    <span class="keyword">return</span> ((<span class="number">1l</span>l * fac[a] * qpow(fac[b], mod - <span class="number">2</span>)) % mod * qpow(fac[a - b], mod - <span class="number">2</span>) % mod) % mod;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> xx, yy, n; <span class="built_in">scanf</span>(<span class="string">&quot;%d %d %d&quot;</span>, &amp;xx, &amp;yy, &amp;n);</span><br><span class="line">    V.resize(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; x : V) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;x.first, &amp;x.second);</span><br><span class="line">    &#125;</span><br><span class="line">    V.emplace_back(<span class="built_in">make_pair</span>(xx, yy));</span><br><span class="line">    sort(V.begin(), V.end());</span><br><span class="line">    Init();</span><br><span class="line">    DP[<span class="number">0</span>] = C(V[<span class="number">0</span>].first + V[<span class="number">0</span>].second - <span class="number">2</span>, V[<span class="number">0</span>].first - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++ i) &#123;</span><br><span class="line">        DP[i] = C(V[i].first + V[i].second - <span class="number">2</span>, V[i].first - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; i; ++ j) &#123;</span><br><span class="line">            <span class="keyword">if</span>(V[j].second &gt; V[i].second) <span class="keyword">continue</span>;</span><br><span class="line">            DP[i] = (<span class="number">1l</span>l * DP[i] - (<span class="number">1l</span>l * DP[j] * C(V[i].first - V[j].first + V[i].second - V[j].second, V[i].first - V[j].first) % mod) + mod) % mod;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, DP[n]);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifdef</span> iyua</span></span><br><span class="line">        system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span> </span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/DP/" rel="tag">DP</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
    <article id="post-划分树" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a  href="../../2021/01/22/%E5%88%92%E5%88%86%E6%A0%91/" class="article-date">
      <time datetime="2021-01-22T13:49:50.000Z" itemprop="datePublished">2021-01-22</time>
</a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a  class="article-title" href="../../2021/01/22/%E5%88%92%E5%88%86%E6%A0%91/">划分树</a>
    </h1>
  


      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>很简单的东西，只能处理静态问题，划分树能实现的主席树都能实现，唯一的优点是这个的空间开销比较小<br>算法流程类似于归并排序，推荐一篇<a target="_blank" rel="noopener" href="https://www.cnblogs.com/hchlqlz-oj-mrj/p/5744308.html">博客</a><br>我认为主要的难点在于，查询时每一层递归到下一层要想好 $l$ 以及 $r$ 怎么变化….写题时建议画图仔细想想<br>空间以及时间复杂度均为 $nlogn$<br>给出求区间 $kth$ 代码</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> de(x)   cerr &lt;&lt; <span class="meta-string">&quot;  debug  &quot;</span> &lt;&lt; #x &lt;&lt; <span class="meta-string">&quot;  ==  &quot;</span> &lt;&lt; x &lt;&lt; endl;</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span>  LL;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">2e5</span> + <span class="number">7</span>;</span><br><span class="line"><span class="keyword">int</span> num[<span class="number">21</span>][maxn], val[<span class="number">21</span>][maxn], n, m;</span><br><span class="line"><span class="keyword">int</span> V[maxn];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> dep, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l == r) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="keyword">int</span> mid = l + r &gt;&gt; <span class="number">1</span>, same = mid - l + <span class="number">1</span>, nl = l, nr = mid + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = l; i &lt;= r; ++ i) same -= (val[dep][i] &lt; V[mid]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = l; i &lt;= r; ++ i) &#123;</span><br><span class="line">        <span class="keyword">if</span>(i == l) num[dep][i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            num[dep][i] = num[dep][i - <span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(val[dep][i] &lt; V[mid] || same &amp;&amp; val[dep][i] == V[mid]) &#123;</span><br><span class="line">            ++ num[dep][i];</span><br><span class="line">            val[dep + <span class="number">1</span>][nl ++] = val[dep][i];</span><br><span class="line">            same -= (val[dep][i] == V[mid]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            val[dep + <span class="number">1</span>][nr ++] = val[dep][i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    build(dep + <span class="number">1</span>, l, mid);</span><br><span class="line">    build(dep + <span class="number">1</span>, mid + <span class="number">1</span>, r);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> md(x, y)    (x + y &gt;&gt; 1)</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">querykth</span><span class="params">(<span class="keyword">int</span> dep, <span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(L == R) <span class="keyword">return</span> val[dep][L];</span><br><span class="line">    <span class="keyword">int</span> tmp = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(l != L) tmp = num[dep][l - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">int</span> mid = l + r &gt;&gt; <span class="number">1</span>, cnt = num[dep][r] - tmp;</span><br><span class="line">    <span class="keyword">if</span>(cnt &gt;= k) &#123;</span><br><span class="line">        <span class="keyword">return</span> querykth(dep + <span class="number">1</span>, L, md(L, R), tmp + L, L + num[dep][r] - <span class="number">1</span>, k);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">int</span> lp1 = (l - L) - tmp;</span><br><span class="line">        <span class="keyword">int</span> lp2 = (r - l + <span class="number">1</span>) - cnt;</span><br><span class="line">        <span class="keyword">return</span> querykth(dep + <span class="number">1</span>, md(L, R) + <span class="number">1</span>, R, md(L, R) + <span class="number">1</span> + lp1, md(L, R) + <span class="number">1</span> + lp1 + lp2 - <span class="number">1</span>, k - cnt);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++ i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, V + i);</span><br><span class="line">        val[<span class="number">0</span>][i] = *(V + i);</span><br><span class="line">    &#125;</span><br><span class="line">    sort(V + <span class="number">1</span>, V + n + <span class="number">1</span>);</span><br><span class="line">    build(<span class="number">0</span>, <span class="number">1</span>, n);</span><br><span class="line">    <span class="keyword">while</span>(m --) &#123;</span><br><span class="line">        <span class="keyword">int</span> l, r, k; <span class="built_in">scanf</span>(<span class="string">&quot;%d %d %d&quot;</span>, &amp;l, &amp;r, &amp;k);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, querykth(<span class="number">0</span>, <span class="number">1</span>, n, l, r, k));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> T = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// scanf(&quot;%d&quot;, &amp;T);</span></span><br><span class="line">    <span class="keyword">while</span>(T --) &#123;</span><br><span class="line">        solve ();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifdef</span> iyua</span></span><br><span class="line">        system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span> </span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" rel="tag">数据结构</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
    <article id="post-洛谷P42699" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a  href="../../2021/01/21/%E6%B4%9B%E8%B0%B7P42699/" class="article-date">
      <time datetime="2021-01-21T14:43:05.000Z" itemprop="datePublished">2021-01-21</time>
</a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a  class="article-title" href="../../2021/01/21/%E6%B4%9B%E8%B0%B7P42699/">洛谷P4269(线段树维护区间合并)</a>
    </h1>
  


      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4269">传送门</a><br>对靴子和雪堆都从大到小排序，然后用双指针的办法，使得扫到每个靴子都尽可能地放入雪堆，之后用线段树维护最长连续区间就可以了</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">2e5</span> + <span class="number">7</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Message</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> op, h, pos, id;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Message&amp; b) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(h != b.h) <span class="keyword">return</span> h &gt; b.h;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> op &gt; b.op;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; arr[maxn];</span><br><span class="line"><span class="keyword">bool</span> yes[maxn];</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ls  (rt &lt;&lt; 1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rs  (rt &lt;&lt; 1|1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> md  (l + r &gt;&gt; 1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lson    ls, l, md</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rson    rs, md + 1, r</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> siz(x)  (Tree[x].r - Tree[x].l + 1)</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SegTree</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> l, r, len, llen, rlen;</span><br><span class="line">&#125; Tree[maxn &lt;&lt; <span class="number">2</span>];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">push_up</span><span class="params">(<span class="keyword">int</span> rt)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> l = Tree[rt].l, r = Tree[rt].r;</span><br><span class="line">    <span class="keyword">if</span>(l == r) <span class="keyword">return</span> ;</span><br><span class="line">    Tree[rt].llen = Tree[ls].llen;</span><br><span class="line">    Tree[rt].rlen = Tree[rs].rlen;</span><br><span class="line">    <span class="keyword">if</span>(Tree[rt].llen == siz(ls)) Tree[rt].llen += Tree[rs].llen;</span><br><span class="line">    <span class="keyword">if</span>(Tree[rt].rlen == siz(rs)) Tree[rt].rlen += Tree[ls].rlen;</span><br><span class="line">    Tree[rt].len = max(max(Tree[rt].llen, Tree[rt].rlen), Tree[ls].rlen + Tree[rs].llen);</span><br><span class="line">    Tree[rt].len = max(Tree[rt].len, max(Tree[ls].len, Tree[rs].len));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">    Tree[rt] = (SegTree) &#123;l, r, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">if</span>(l == r) <span class="keyword">return</span> ;</span><br><span class="line">    build(lson);</span><br><span class="line">    build(rson);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">updata</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> pos)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> l = Tree[rt].l, r = Tree[rt].r;</span><br><span class="line">    <span class="keyword">if</span>(l == r &amp;&amp; l == pos) &#123;</span><br><span class="line">        Tree[rt].len = Tree[rt].llen = Tree[rt].rlen = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(pos &lt;= md) updata(ls, pos);</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        updata(rs, pos);</span><br><span class="line">    &#125;</span><br><span class="line">    push_up(rt);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n, m; <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">    <span class="comment">// int op, h, pos, id;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++ i) &#123;</span><br><span class="line">        arr[i] = (Message) &#123;<span class="number">1</span>, <span class="number">0</span>, i, <span class="number">0</span>&#125;;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;arr[i].h);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++ i) &#123;</span><br><span class="line">        arr[i + n] = (Message) &#123;<span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, i&#125;;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;arr[i + n].h, &amp;arr[i + n].pos);</span><br><span class="line">    &#125;</span><br><span class="line">    sort(arr + <span class="number">1</span>, arr + n + m + <span class="number">1</span>);</span><br><span class="line">    build(<span class="number">1</span>, <span class="number">1</span>, n);</span><br><span class="line">    <span class="keyword">bool</span> vis[maxn];</span><br><span class="line">    <span class="comment">// int op, h, pos, id;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n + m; ++ i) &#123;</span><br><span class="line">        <span class="keyword">if</span>(arr[i].op == <span class="number">1</span>) &#123;</span><br><span class="line">            updata(<span class="number">1</span>, arr[i].pos);</span><br><span class="line">            vis[arr[i].pos] = <span class="number">1</span>;</span><br><span class="line">            <span class="comment">// cout &lt;&lt; arr[i].pos &lt;&lt; endl;</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// if(arr[i].h == 0 &amp;&amp; arr[i].pos == 5) &#123;</span></span><br><span class="line">            <span class="comment">//     printf(&quot;%d %d\n&quot;, arr[i].pos, Tree[1].len);</span></span><br><span class="line">            <span class="comment">//     for (int j = 1; j &lt;= n; ++ j) cout &lt;&lt; (vis[j] ? &#x27;1&#x27; : &#x27;0&#x27;);</span></span><br><span class="line">            <span class="comment">//     cout &lt;&lt; endl;</span></span><br><span class="line">            <span class="comment">// &#125;</span></span><br><span class="line">            <span class="keyword">int</span> len = Tree[<span class="number">1</span>].len;</span><br><span class="line">            <span class="keyword">if</span>(len &gt;= arr[i].pos) &#123;</span><br><span class="line">                yes[arr[i].id] = <span class="literal">false</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                yes[arr[i].id] = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++ i) <span class="built_in">puts</span>(yes[i] ? <span class="string">&quot;1&quot;</span> : <span class="string">&quot;0&quot;</span>);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifdef</span> iyua</span></span><br><span class="line">        system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" rel="tag">数据结构</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
    <article id="post-整体二分" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a  href="../../2021/01/21/%E6%95%B4%E4%BD%93%E4%BA%8C%E5%88%86/" class="article-date">
      <time datetime="2021-01-21T14:31:51.000Z" itemprop="datePublished">2021-01-21</time>
</a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a  class="article-title" href="../../2021/01/21/%E6%95%B4%E4%BD%93%E4%BA%8C%E5%88%86/">整体二分</a>
    </h1>
  


      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>复习了下三个月前学的东西，但感觉还是只学到了皮毛，只会写简单题..额<br>现在只会写比较简单的带修区间 $kth$ 这种题<br>有点 $CDQ$ 分治的感觉，这里是把所有答案一起二分<br>伪代码为</p>
<p>递归 权值区间  询问区间<br>权值区间长度为1时记录答案并返回<br>否则就以权值中值来二分询问分组，之后权值减半，继续递归下去</p>
<p>要求能离线，且答案具有单调性<br><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3332">洛谷P3332</a><br>操作一看作区间修改，操作二看做区间 $kth$ 就可以了<br>每次二分权值来决定操作一是否要执行，并通过 $query$ 来分组操作二</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> de(x)   cerr &lt;&lt; <span class="meta-string">&quot;  debug  &quot;</span> &lt;&lt; #x &lt;&lt; <span class="meta-string">&quot;  ==  &quot;</span> &lt;&lt; x &lt;&lt; endl;</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span>  LL;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">5e4</span> + <span class="number">7</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ls  (rt &lt;&lt; 1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rs  (rt &lt;&lt; 1|1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> md  (l + r &gt;&gt; 1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lson    ls, l, md</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rson    rs, md + 1, r</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> len(x)  (1ll * (Tree[x].r - Tree[x].l + 1))</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SegTree</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> l, r, tag;</span><br><span class="line">    LL sum;</span><br><span class="line">&#125; Tree[maxn &lt;&lt; <span class="number">2</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">    Tree[rt] = (SegTree) &#123;l, r, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">if</span>(l != r) &#123;</span><br><span class="line">        build(lson);</span><br><span class="line">        build(rson);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">push_up</span><span class="params">(<span class="keyword">int</span> rt)</span> </span>&#123;</span><br><span class="line">    Tree[rt].sum = Tree[ls].sum + Tree[rs].sum;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">push_down</span><span class="params">(<span class="keyword">int</span> rt)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> l = Tree[rt].l, r = Tree[rt].r;</span><br><span class="line">    <span class="keyword">if</span>(!Tree[rt].tag) <span class="keyword">return</span> ;</span><br><span class="line">    Tree[ls].tag += Tree[rt].tag;</span><br><span class="line">    Tree[rs].tag += Tree[rt].tag;</span><br><span class="line">    Tree[ls].sum += len(ls) * Tree[rt].tag;</span><br><span class="line">    Tree[rs].sum += len(rs) * Tree[rt].tag;</span><br><span class="line">    Tree[rt].tag = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">updata</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> L, <span class="keyword">int</span> R, <span class="keyword">int</span> tag)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> l = Tree[rt].l, r = Tree[rt].r;</span><br><span class="line">    <span class="keyword">if</span>(l == L &amp;&amp; r == R) &#123;</span><br><span class="line">        Tree[rt].sum += len(rt) * tag;</span><br><span class="line">        Tree[rt].tag += tag;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    push_down(rt);</span><br><span class="line">    <span class="keyword">if</span>(R &lt;= md) updata(ls, L, R, tag);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(L &gt;= md + <span class="number">1</span>) updata(rs, L, R, tag);</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        updata(ls, L, md, tag);</span><br><span class="line">        updata(rs, md + <span class="number">1</span>, R, tag);</span><br><span class="line">    &#125;</span><br><span class="line">    push_up(rt);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">LL <span class="title">query</span><span class="params">(<span class="keyword">int</span> rt, <span class="keyword">int</span> L, <span class="keyword">int</span> R)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> l = Tree[rt].l, r = Tree[rt].r;</span><br><span class="line">    <span class="keyword">if</span>(l == L &amp;&amp; r == R) &#123;</span><br><span class="line">        <span class="keyword">return</span> Tree[rt].sum;</span><br><span class="line">    &#125;</span><br><span class="line">    push_down(rt);</span><br><span class="line">    <span class="keyword">if</span>(R &lt;= md) <span class="keyword">return</span> query(ls, L, R);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(L &gt;= md + <span class="number">1</span>) <span class="keyword">return</span> query(rs, L, R);</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> query(ls, L, md) + query(rs, md + <span class="number">1</span>, R);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">READ</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> op, l, r, k, id;</span><br><span class="line">&#125; Q[maxn], tmpl[maxn], tmpr[maxn];</span><br><span class="line"><span class="keyword">int</span> res[maxn];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Devide</span><span class="params">(<span class="keyword">int</span> vl, <span class="keyword">int</span> vr, <span class="keyword">int</span> ql, <span class="keyword">int</span> qr)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(vl &gt; vr || ql &gt; qr) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="keyword">if</span>(vl == vr) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = ql; i &lt;= qr; ++ i) &#123;</span><br><span class="line">            <span class="keyword">if</span>(Q[i].op == <span class="number">2</span>) res[Q[i].id] = vl;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> mid = vl + vr &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> nl = <span class="number">0</span>, nr = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = ql; i &lt;= qr; ++ i) &#123;</span><br><span class="line">        <span class="keyword">if</span>(Q[i].op == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(Q[i].k &gt; mid) &#123;</span><br><span class="line">                updata(<span class="number">1</span>, Q[i].l, Q[i].r, <span class="number">1</span>);</span><br><span class="line">                tmpr[++ nr] = Q[i];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                tmpl[++ nl] = Q[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            LL cnt = query(<span class="number">1</span>, Q[i].l, Q[i].r);</span><br><span class="line">            <span class="keyword">if</span>(cnt &gt;= Q[i].k) &#123;</span><br><span class="line">                tmpr[++ nr] = Q[i];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                tmpl[++ nl] = Q[i];</span><br><span class="line">                tmpl[nl].k -= cnt;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = ql; i &lt;= qr; ++ i) &#123;</span><br><span class="line">        <span class="keyword">if</span>(Q[i].op == <span class="number">1</span> &amp;&amp; Q[i].k &gt; mid) updata(<span class="number">1</span>, Q[i].l, Q[i].r, <span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= nl; ++ i) Q[ql + i - <span class="number">1</span>] = tmpl[i];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= nr; ++ i) Q[ql + nl + i - <span class="number">1</span>] = tmpr[i];</span><br><span class="line">    Devide(vl, mid, ql, ql + nl - <span class="number">1</span>);</span><br><span class="line">    Devide(mid + <span class="number">1</span>, vr, ql + nl, qr);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n, m; <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">    <span class="keyword">int</span> tim = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++ i) &#123;</span><br><span class="line">        <span class="keyword">int</span> op, l, r, k;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d %d %d %d&quot;</span>, &amp;op, &amp;l, &amp;r, &amp;k);</span><br><span class="line">        Q[i] = (READ) &#123;op, l, r, k, i&#125;;</span><br><span class="line">        <span class="keyword">if</span>(op == <span class="number">2</span>) Q[i].id = ++ tim;</span><br><span class="line">    &#125;</span><br><span class="line">    build(<span class="number">1</span>, <span class="number">1</span>, n);</span><br><span class="line">    Devide(-n, n, <span class="number">1</span>, m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= tim; ++ i) <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, res[i]);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifdef</span> iyua</span></span><br><span class="line">        system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span> </span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P2617">洛谷P2617</a><br>把修改看成，先删除原有的数，再插入新的数就可以了</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> de(x)   cerr &lt;&lt; <span class="meta-string">&quot;  debug  &quot;</span> &lt;&lt; #x &lt;&lt; <span class="meta-string">&quot;  ==  &quot;</span> &lt;&lt; x &lt;&lt; endl;</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span>  LL;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">1e5</span> + <span class="number">7</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lowbit(x)   (x &amp; (-x))</span></span><br><span class="line"><span class="keyword">int</span> n, m, V[maxn], res[maxn], tim;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TreeArray</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> Tree[maxn];</span><br><span class="line">    TreeArray() &#123;</span><br><span class="line">        <span class="built_in">memset</span>(Tree, <span class="number">0</span>, <span class="keyword">sizeof</span>(Tree));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> tag)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(x &lt;= n) &#123;</span><br><span class="line">            Tree[x] += tag;</span><br><span class="line">            x += lowbit(x);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(x)  &#123;</span><br><span class="line">            res += Tree[x];</span><br><span class="line">            x -= lowbit(x);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; BIT;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">READ</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> op, l, r, k, id;</span><br><span class="line">&#125; Q[maxn * <span class="number">3</span>], lq[maxn * <span class="number">3</span>], rq[maxn * <span class="number">3</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Devide</span><span class="params">(<span class="keyword">int</span> vl, <span class="keyword">int</span> vr, <span class="keyword">int</span> ql, <span class="keyword">int</span> qr)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(vl &gt; vr || ql &gt; qr) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="keyword">if</span>(vl == vr) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = ql; i &lt;= qr; ++ i) &#123;</span><br><span class="line">            <span class="keyword">if</span>(Q[i].op == <span class="number">2</span>) &#123;</span><br><span class="line">                res[Q[i].id] = vl;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> mid = vl + vr &gt;&gt; <span class="number">1</span>, nl = <span class="number">0</span>, nr = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = ql; i &lt;= qr; ++ i) &#123;</span><br><span class="line">        <span class="keyword">if</span>(Q[i].op != <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(Q[i].r &lt;= mid) &#123;</span><br><span class="line">                lq[++ nl] = Q[i];</span><br><span class="line">                BIT.add(Q[i].l, Q[i].op);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                rq[++ nr] = Q[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">int</span> cnt = BIT.query(Q[i].r) - BIT.query(Q[i].l - <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span>(Q[i].k &lt;= cnt) &#123;</span><br><span class="line">                lq[++ nl] = Q[i];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                Q[i].k -= cnt;</span><br><span class="line">                rq[++ nr] = Q[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = ql; i &lt;= qr; ++ i) &#123;</span><br><span class="line">        <span class="keyword">if</span>(Q[i].op != <span class="number">2</span> &amp;&amp; Q[i].r &lt;= mid) BIT.add(Q[i].l, - Q[i].op);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= nl; ++ i) Q[ql + i - <span class="number">1</span>] = lq[i];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= nr; ++ i) Q[ql + nl - <span class="number">1</span> + i] = rq[i];</span><br><span class="line">    Devide(vl, mid, ql, ql + nl - <span class="number">1</span>);</span><br><span class="line">    Devide(mid + <span class="number">1</span>, vr, ql + nl, qr);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++ i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, V + i);</span><br><span class="line">        Q[i] = (READ) &#123;<span class="number">1</span>, i, V[i], <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> tot = n;</span><br><span class="line">    tim = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++ i) &#123;</span><br><span class="line">        <span class="keyword">char</span> op[<span class="number">10</span>]; <span class="keyword">int</span> l, r, k;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, op);</span><br><span class="line">        <span class="keyword">if</span>(op[<span class="number">0</span>] == <span class="string">&#x27;Q&#x27;</span>) &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d %d %d&quot;</span>, &amp;l, &amp;r, &amp;k);</span><br><span class="line">            Q[++ tot] = (READ) &#123;<span class="number">2</span>, l, r, k, ++ tim&#125;;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;   </span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;l, &amp;r);</span><br><span class="line">            Q[++ tot] = (READ) &#123;<span class="number">-1</span>, l, V[l], <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">            V[l] = r;</span><br><span class="line">            Q[++ tot] = (READ) &#123;<span class="number">1</span>, l, V[l], <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Devide(<span class="number">-1e9</span>, <span class="number">1e9</span>, <span class="number">1</span>, tot);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= tim; ++ i) <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, res[i]);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifdef</span> iyua</span></span><br><span class="line">        system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span> </span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P1527">洛谷P1527</a><br>同上，，只是这里修改变成了二维罢了，一个树状数组就可以了</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> de(x)   cerr &lt;&lt; <span class="meta-string">&quot;  debug  &quot;</span> &lt;&lt; #x &lt;&lt; <span class="meta-string">&quot;  ==  &quot;</span> &lt;&lt; x &lt;&lt; endl;</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span>  LL;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">5e2</span> + <span class="number">7</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> lowbit(x)   (x &amp; (-x))</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TreeArray</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> n, m;<span class="comment">//  行列</span></span><br><span class="line">    <span class="keyword">int</span> Tree[maxn][maxn];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Init</span><span class="params">(<span class="keyword">int</span> _n)</span> </span>&#123;</span><br><span class="line">        n = m = _n;</span><br><span class="line">        <span class="built_in">memset</span>(Tree, <span class="number">0</span>, <span class="keyword">sizeof</span>(Tree));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 修改坐标x,y的值</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> X = x; X &lt;= n; X += lowbit(X)) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> Y = y; Y &lt;= m; Y += lowbit(Y)) &#123;</span><br><span class="line">                Tree[X][Y] += val;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 查询1,1到x,y的矩阵之和</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> X = x; X &gt;= <span class="number">1</span>; X -= lowbit(X)) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> Y = y; Y &gt;= <span class="number">1</span>; Y -= lowbit(Y)) &#123;</span><br><span class="line">                res += Tree[X][Y];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 容斥一下</span></span><br><span class="line">    <span class="comment">//  x1 y1 x2 y2</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">range_query</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b, <span class="keyword">int</span> c, <span class="keyword">int</span> d)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> query(c,d) - query(c, b<span class="number">-1</span>) - query(a<span class="number">-1</span>, d) + query(a - <span class="number">1</span>, b<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;BIT;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxm = <span class="number">1e6</span> + <span class="number">7</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">READ</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> op, xa, ya, xb, yb, k, id;</span><br><span class="line">&#125; Q[maxm], lq[maxm], rq[maxm];</span><br><span class="line"><span class="keyword">int</span> res[maxm];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Devide</span><span class="params">(<span class="keyword">int</span> vl, <span class="keyword">int</span> vr, <span class="keyword">int</span> ql, <span class="keyword">int</span> qr)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(vl &gt; vr || ql &gt; qr) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="keyword">if</span>(vl == vr) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = ql; i &lt;= qr; ++ i) &#123;</span><br><span class="line">            <span class="keyword">if</span>(Q[i].op == <span class="number">2</span>) &#123;</span><br><span class="line">                res[Q[i].id] = vl;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> nl = <span class="number">0</span>, nr = <span class="number">0</span>, mid = vl + vr &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = ql; i &lt;= qr; ++ i) &#123;</span><br><span class="line">        <span class="keyword">if</span>(Q[i].op == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(Q[i].k &lt;= mid) &#123;</span><br><span class="line">                BIT.add(Q[i].xa, Q[i].ya, <span class="number">1</span>);</span><br><span class="line">                lq[++ nl] = Q[i];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                rq[++ nr] = Q[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">int</span> cnt = BIT.range_query(Q[i].xa, Q[i].ya, Q[i].xb, Q[i].yb);</span><br><span class="line">            <span class="keyword">if</span>(Q[i].k &lt;= cnt) &#123;</span><br><span class="line">                lq[++ nl] = Q[i];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                Q[i].k -= cnt;</span><br><span class="line">                rq[++ nr] = Q[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = ql; i &lt;= qr; ++ i) &#123;</span><br><span class="line">        <span class="keyword">if</span>(Q[i].op == <span class="number">1</span> &amp;&amp; Q[i].k &lt;= mid) BIT.add(Q[i].xa, Q[i].ya, <span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= nl; ++ i) Q[ql + i - <span class="number">1</span>] = lq[i];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= nr; ++ i) Q[ql + nl + i - <span class="number">1</span>] = rq[i];</span><br><span class="line">    Devide(vl, mid, ql, ql + nl - <span class="number">1</span>);</span><br><span class="line">    Devide(mid + <span class="number">1</span>, vr, ql + nl, qr);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n, m; <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">    BIT.Init(n);</span><br><span class="line">    <span class="keyword">int</span> tot = <span class="number">0</span>, tim = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++ i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; ++ j) &#123;</span><br><span class="line">            <span class="keyword">int</span> x; <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;x);</span><br><span class="line">            Q[++ tot] = (READ) &#123;<span class="number">1</span>, i, j, i, j, x, <span class="number">0</span>&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++ i) &#123;</span><br><span class="line">        <span class="keyword">int</span> xa, ya, xb, yb, k;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d %d %d %d %d&quot;</span>, &amp;xa, &amp;ya, &amp;xb, &amp;yb, &amp;k);</span><br><span class="line">        Q[++ tot] = (READ) &#123;<span class="number">2</span>, xa, ya, xb, yb, k, ++ tim&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    Devide(<span class="number">-1e9</span>, <span class="number">1e9</span>, <span class="number">1</span>, tot);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= tim; ++ i) <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, res[i]);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifdef</span> iyua</span></span><br><span class="line">        system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span> </span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/%E6%9D%82%E9%A1%B9/" rel="tag">杂项</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
    <article id="post-莫队" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a  href="../../2021/01/20/%E8%8E%AB%E9%98%9F/" class="article-date">
      <time datetime="2021-01-20T15:54:20.000Z" itemprop="datePublished">2021-01-20</time>
</a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a  class="article-title" href="../../2021/01/20/%E8%8E%AB%E9%98%9F/">莫队</a>
    </h1>
  


      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>莫队算法真的是博大精深…学麻了<br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Paul-Guderian/p/6933799.html">博客一</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/zhangjianjunab/article/details/101313857?utm_medium=distribute.pc_relevant.none-task-blog-OPENSEARCH-3.control&depth_1-utm_source=distribute.pc_relevant.none-task-blog-OPENSEARCH-3.control">博客二</a><br>首先要学会最基础的分块这个概念<br>我理解的莫队是，离线处理一些区间询问问题，要求数据范围不能超过 $2e5$， 以及从 $(L, R)$ 区间的贡献转移到 $(L, R + 1)$ 区间的贡献要能快速求出，一般需要为 $O(1)$复杂度<br>刷<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/list?keyword=&tag=41&page=1">这个专题</a>吧， 我还只写了五六题，，等慢慢补，以下只给出经典例题</p>
<h6 id="复杂度证明"><a href="#复杂度证明" class="headerlink" title="复杂度证明"></a>复杂度证明</h6><p>假设块大小为block</p>
<p>对于普通莫队<br>左指针  在每一个块内，单次最多移动$block$，有$n/block$ 个块，每个块$block$ 次移动，所以为 $block * block * (n / block)$<br>右指针 在每一个块内，右指针是有序的，最多移动$n$， 有$n / block$ 个块，所以为 $n^2/block$<br>总体为$ n * block + n^2 / block$, 由基本不等式可得， $block$ 为 $sqrt(n)$ 时，函数取到最值</p>
<p>对于带修莫队<br>由于加了个时间属性，且只有左右块相同时才比较时间，其他的不变，所以是 $ n * block + n^2 / block + O(T)$, 只需要计算 $O(T)$ 就可以了<br>考虑 $T$ 如何跳跃， 对于每一个相同左相同右的块，时间是有序的，最多移动 $n$ 次，那么考虑有多少个相同的块，最坏情况是均分，所有有 $n / block$ 个左和 $n / block$ 个右，所以时间复杂度是 $ (n / block)^2 * n$<br>总体就是$ n * block + n^2 / block + (n / block)^2 * n$<br>解方程发现， $block$ 为 $pow(n, 2.0/ 3)$ 时是函数最值，取到 $O(n^{5/3})$</p>
<h6 id="优化技巧"><a href="#优化技巧" class="headerlink" title="优化技巧"></a>优化技巧</h6><p>在左块相同时，看左块为奇数，则右块从小到大，偶数则从大到小<br>玄学优化</p>
<h6 id="简单莫队"><a href="#简单莫队" class="headerlink" title="简单莫队"></a>简单莫队</h6><p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P1494">洛谷P1494</a><br>贡献转移很好计算，可以 $O(1)$ 计算出</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">res -= cnt[x] * (cnt[x] - 1) / 2;</span><br><span class="line">cnt[x] += tag;</span><br><span class="line">res += cnt[x] * (cnt[x] - 1) / 2;</span><br></pre></td></tr></table></figure>
<p>给出代码</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span>   LL;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">5e4</span> + <span class="number">7</span>;</span><br><span class="line"><span class="keyword">int</span> n, m, L, R;</span><br><span class="line">LL ans, cnt[maxn], belong[maxn], block, a[maxn], res_up[maxn], res_down[maxn];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> l, r, id;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Node&amp; b) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(belong[l] == belong[b.l]) &#123;</span><br><span class="line">            <span class="keyword">return</span> r &lt; b.r;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> belong[l] &lt; belong[b.l];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;Q[maxn];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(LL x)</span> </span>&#123;</span><br><span class="line">    ans -= cnt[x] * (cnt[x] - <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">    ++ cnt[x];</span><br><span class="line">    ans += cnt[x] * (cnt[x] - <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">del</span><span class="params">(LL x)</span> </span>&#123;</span><br><span class="line">    ans -= cnt[x] * (cnt[x] - <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">    -- cnt[x];</span><br><span class="line">    ans += cnt[x] * (cnt[x] - <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">    block = <span class="built_in">sqrt</span>(n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++ i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>, &amp;a[i]);</span><br><span class="line">        belong[i] = (i - <span class="number">1</span>) / block + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++ i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;Q[i].l, &amp;Q[i].r);</span><br><span class="line">        Q[i].id = i;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ans = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">memset</span>(cnt, <span class="number">0</span>, <span class="keyword">sizeof</span>(cnt));</span><br><span class="line">    sort(Q + <span class="number">1</span>, Q + m + <span class="number">1</span>);</span><br><span class="line">    L = <span class="number">1</span>, R = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++ i) &#123;</span><br><span class="line">        <span class="keyword">int</span> l = Q[i].l, r = Q[i].r, id = Q[i].id;</span><br><span class="line">        <span class="keyword">if</span>(l == r) &#123;</span><br><span class="line">            res_up[id] = <span class="number">0</span>;</span><br><span class="line">            res_down[id] = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(L &lt; l) &#123;</span><br><span class="line">            del(a[L ++]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(L &gt; l) &#123;</span><br><span class="line">            add(a[-- L]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(R &gt; r) &#123;</span><br><span class="line">            del(a[R --]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(R &lt; r) &#123;</span><br><span class="line">            add(a[++ R]);</span><br><span class="line">        &#125;</span><br><span class="line">        res_up[id] = ans;</span><br><span class="line">        res_down[id] = <span class="number">1l</span>l * (r - l + <span class="number">1</span>) * (r - l) / <span class="number">2l</span>l;</span><br><span class="line">        LL gcd = __gcd(res_up[id], res_down[id]);</span><br><span class="line">        res_up[id] /= gcd;</span><br><span class="line">        res_down[id] /= gcd;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++ i) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld/%lld\n&quot;</span>, res_up[i], res_down[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="带修莫队"><a href="#带修莫队" class="headerlink" title="带修莫队"></a>带修莫队</h6><p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P1903">洛谷P1903</a><br>和普通莫队大致一样，这里需要加一个时间轴的属性，每次暴力跳边时还需跳时间轴，带修莫队块为 $pow(n, 2.0/3)$ 时最佳</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span>  LL;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">2e5</span> + <span class="number">7</span>;</span><br><span class="line"><span class="keyword">int</span> n, m, block, belong[maxn], V[maxn], Num[maxn * <span class="number">5</span>];</span><br><span class="line"><span class="keyword">int</span> L, R, T, res, ans[maxn];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Mo</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> l, r, t, id;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Mo&amp; B) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(belong[l] != belong[B.l]) <span class="keyword">return</span> belong[l] &lt; belong[B.l];</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(belong[r] != belong[B.r]) <span class="keyword">return</span> belong[l] &amp; <span class="number">1</span> ? r &lt; B.r : r &gt; B.r;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> t &lt; B.t;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; Q[maxn];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">C</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> pos, val;</span><br><span class="line">&#125; change[maxn];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(++ Num[x] == <span class="number">1</span>) ++ res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">del</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(-- Num[x] == <span class="number">0</span>) -- res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Fly</span><span class="params">(<span class="keyword">int</span> pos)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(change[pos].pos &gt;= L &amp;&amp; change[pos].pos &lt;= R) &#123;</span><br><span class="line">        del(V[change[pos].pos]);</span><br><span class="line">        add(change[pos].val);</span><br><span class="line">    &#125;</span><br><span class="line">    swap(V[change[pos].pos], change[pos].val);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">    <span class="comment">// block = sqrt(1.0 * n);</span></span><br><span class="line">    block = <span class="built_in">pow</span>(n, <span class="number">2.0</span> / <span class="number">3</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++ i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, V + i);</span><br><span class="line">        belong[i] = (i - <span class="number">1</span>) / block + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> nowT = <span class="number">0</span>, cnt = <span class="number">0</span>; <span class="keyword">char</span> op[<span class="number">10</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++ i) &#123;</span><br><span class="line">        <span class="keyword">int</span> l, r; <span class="built_in">scanf</span>(<span class="string">&quot;%s %d %d&quot;</span>, op, &amp;l, &amp;r);</span><br><span class="line">        <span class="keyword">if</span>(op[<span class="number">0</span>] == <span class="string">&#x27;Q&#x27;</span>) &#123;</span><br><span class="line">            ++ cnt;</span><br><span class="line">            Q[cnt] = (Mo) &#123;l, r, nowT, cnt&#125;;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            change[++ nowT] = (C) &#123;l, r&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    sort(Q + <span class="number">1</span>, Q + cnt + <span class="number">1</span>);</span><br><span class="line">    L = <span class="number">1</span>, R = <span class="number">0</span>, T = <span class="number">0</span>, res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= cnt; ++ i) &#123;</span><br><span class="line">        <span class="keyword">int</span> l = Q[i].l, r = Q[i].r, t = Q[i].t, id = Q[i].id;</span><br><span class="line">        <span class="keyword">while</span>(T &lt; t) Fly(++ T);</span><br><span class="line">        <span class="keyword">while</span>(T &gt; t) Fly(T --);</span><br><span class="line">        <span class="keyword">while</span>(R &lt; r) add(V[++ R]);</span><br><span class="line">        <span class="keyword">while</span>(R &gt; r) del(V[R --]);</span><br><span class="line">        <span class="keyword">while</span>(L &lt; l) del(V[L ++]);</span><br><span class="line">        <span class="keyword">while</span>(L &gt; l) add(V[-- L]);</span><br><span class="line">        ans[id] = res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= cnt; ++ i) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, ans[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifdef</span> iyua</span></span><br><span class="line">        system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span> </span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="树上莫队"><a href="#树上莫队" class="headerlink" title="树上莫队"></a>树上莫队</h6><p>大同小异，这里利用$欧拉序$，将树哈希成线性结构，然后在欧拉序上跑莫队就可以了，不用 $DFS$ 序的原因是，不好处理 $LCA$ 的贡献<br><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/SP10707">SP10707 COT2 - Count on a tree II</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="comment">// #define de(x)   cerr &lt;&lt; &quot;  debug  &quot; &lt;&lt; #x &lt;&lt; &quot;  ==  &quot; &lt;&lt; x &lt;&lt; endl;</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> belong(x)   ((x - 1) / block + 1)</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span>  LL;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">1e5</span> + <span class="number">7</span>;</span><br><span class="line"><span class="keyword">int</span> st[maxn], ed[maxn], rk[maxn], V[maxn], tmp[maxn], n, m, tim, block;</span><br><span class="line"><span class="keyword">int</span> vis[maxn], siz[maxn], son[maxn], fa[maxn][<span class="number">21</span>], dep[maxn];</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; G[maxn];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFS1</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> fr)</span> </span>&#123;</span><br><span class="line">    st[u] = ++ tim;</span><br><span class="line">    rk[tim] = u;</span><br><span class="line">    fa[u][<span class="number">0</span>] = fr;</span><br><span class="line">    dep[u] = dep[fr] + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; (<span class="number">1</span> &lt;&lt; i) &lt;= n; ++ i) fa[u][i] = fa[fa[u][i - <span class="number">1</span>]][i - <span class="number">1</span>];</span><br><span class="line">    siz[u] = <span class="number">1</span>; son[u] = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G[u].size(); ++ i) &#123;</span><br><span class="line">        <span class="keyword">int</span> v = G[u][i];</span><br><span class="line">        <span class="keyword">if</span>(v == fr) <span class="keyword">continue</span>;</span><br><span class="line">        DFS1(v, u);</span><br><span class="line">        siz[u] += siz[v];</span><br><span class="line">        <span class="keyword">if</span>(son[u] == <span class="number">-1</span> || siz[v] &gt; siz[son[u]]) son[u] = v;</span><br><span class="line">    &#125;</span><br><span class="line">    ed[u] = ++ tim;</span><br><span class="line">    rk[tim] = u;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">LCA</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(dep[u] &lt; dep[v]) swap(u, v);</span><br><span class="line">    <span class="keyword">int</span> d = dep[u] - dep[v];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; (<span class="number">1</span> &lt;&lt; i) &lt;= d; ++ i) <span class="keyword">if</span>((d &gt;&gt; i) &amp; <span class="number">1</span>) u = fa[u][i];</span><br><span class="line">    <span class="keyword">if</span>(u == v) <span class="keyword">return</span> u;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">20</span>; i &gt;= <span class="number">0</span>; -- i) &#123;</span><br><span class="line">        <span class="keyword">if</span>(fa[u][i] != fa[v][i]) &#123;</span><br><span class="line">            u = fa[u][i];</span><br><span class="line">            v = fa[v][i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> fa[u][<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Mo</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> l, r, lca, id;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Mo&amp; B) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(belong(l) == belong(B.l)) <span class="keyword">return</span> r &lt; B.r;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> l &lt; B.l;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; Q[maxn];</span><br><span class="line"><span class="keyword">int</span> res[maxn], cnt[maxn], L, R, ans;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// cout &lt;&lt; &quot; add  &quot; &lt;&lt; x &lt;&lt; endl;</span></span><br><span class="line">    ans += (++ cnt[x] == <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">del</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// cout &lt;&lt; &quot;  del &quot; &lt;&lt; x &lt;&lt; endl; </span></span><br><span class="line">    ans -= (-- cnt[x] == <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Fly</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    (vis[x] ^= <span class="number">1</span>);</span><br><span class="line">    vis[x] ? add(V[x]) : del(V[x]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">    block = <span class="built_in">sqrt</span>(<span class="number">2.0</span> * n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++ i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, V + i);</span><br><span class="line">        tmp[i] = *(V + i);</span><br><span class="line">    &#125;</span><br><span class="line">    sort(tmp + <span class="number">1</span>, tmp + n + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">int</span> len = unique(tmp + <span class="number">1</span>, tmp + n + <span class="number">1</span>) - tmp - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++ i) V[i] = lower_bound(tmp + <span class="number">1</span>, tmp + len + <span class="number">1</span>, V[i]) - tmp;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; ++ i) &#123;</span><br><span class="line">        <span class="keyword">int</span> u, v;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;u, &amp;v);</span><br><span class="line">        G[u].push_back(v);</span><br><span class="line">        G[v].push_back(u);</span><br><span class="line">    &#125;</span><br><span class="line">    DFS1(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++ i) &#123;</span><br><span class="line">        <span class="keyword">int</span> u, v; <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;u, &amp;v);</span><br><span class="line">        <span class="keyword">if</span>(st[u] &gt; st[v]) swap(u, v);</span><br><span class="line">        <span class="keyword">int</span> lca = LCA(u, v);</span><br><span class="line">        <span class="keyword">if</span>(lca == u) &#123;</span><br><span class="line">            Q[i] = (Mo) &#123;st[u], st[v], <span class="number">0</span>, i&#125;;</span><br><span class="line">            <span class="comment">// cout &lt;&lt; &quot;===&quot; &lt;&lt;  st[u] &lt;&lt; &#x27; &#x27; &lt;&lt; st[v] &lt;&lt; endl;</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Q[i] = (Mo) &#123;ed[u], st[v], lca, i&#125;;</span><br><span class="line">            <span class="comment">// cout &lt;&lt; &quot;====&quot; &lt;&lt; ed[u] &lt;&lt; &#x27; &#x27; &lt;&lt; st[v] &lt;&lt; endl;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    sort(Q + <span class="number">1</span>, Q + m + <span class="number">1</span>);</span><br><span class="line">    ans = <span class="number">0</span>; L = <span class="number">1</span>; R = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++ i) &#123;</span><br><span class="line">        <span class="keyword">int</span> l = Q[i].l, r = Q[i].r, lca = Q[i].lca, id = Q[i].id;</span><br><span class="line">        <span class="keyword">while</span>(R &lt; r) Fly(rk[++ R]);</span><br><span class="line">        <span class="keyword">while</span>(R &gt; r) Fly(rk[R --]);</span><br><span class="line">        <span class="keyword">while</span>(L &lt; l) Fly(rk[L ++]);</span><br><span class="line">        <span class="keyword">while</span>(L &gt; l) Fly(rk[-- L]);</span><br><span class="line">        <span class="keyword">if</span>(lca) Fly(lca);</span><br><span class="line">        res[id] = ans;</span><br><span class="line">        <span class="keyword">if</span>(lca) Fly(lca);</span><br><span class="line">        <span class="comment">// de(l)</span></span><br><span class="line">        <span class="comment">// de(r)</span></span><br><span class="line">        <span class="comment">// de(lca)</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++ i) <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, res[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> T = <span class="number">1</span>; <span class="comment">//scanf(&quot;%d&quot;, &amp;T);</span></span><br><span class="line">    <span class="keyword">while</span>(T --) &#123;</span><br><span class="line">        solve ();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifdef</span> iyua</span></span><br><span class="line">        system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span> </span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="回滚莫队"><a href="#回滚莫队" class="headerlink" title="回滚莫队"></a>回滚莫队</h6><p>待补(咕咕咕)…</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" rel="tag">数据结构</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
    <article id="post-dsu-on-tree" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a  href="../../2021/01/19/dsu-on-tree/" class="article-date">
      <time datetime="2021-01-19T13:08:56.000Z" itemprop="datePublished">2021-01-19</time>
</a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a  class="article-title" href="../../2021/01/19/dsu-on-tree/">dsu on tree</a>
    </h1>
  


      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>$dsu on tree$  就是<strong>树上启发式合并</strong>，主要借鉴了并查集按秩合并的思想来衍生出的一种<strong>优化暴力</strong>的方法<br>前置知识 </p>
<ol>
<li>懂树链剖分</li>
</ol>
<p>主要是用来处理子树问题，比如统计以某个点为根的子树内什么什么的个数，这类问题一般都能很轻易敲除 $O(n^2)$ 的暴力解法，而 $dsu on tree$ 就是借鉴按秩合并的思想，依靠树链剖分剖出的重儿子的形式来把算法优化至$O(nlogn)$<br>大致流程</p>
<p>先树剖出重儿子<br>然后跑 dsu on tree<br>递归处理这个点的所有子树，先处理轻儿子然后删除影响<br>在处理重儿子，不删除影响，同时暴力求出此根的答案<br>之后根据传入的参数决定这个根的影响是否要被删除</p>
<p>没了，形式是多变的，主要还是要多刷题多见识<br><del>有不少子树内统计贡献问题可以用 dfs序 哈希成线性结构然后跑一个莫队来求</del><br><del>确实这样ac过一些题…</del></p>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/CF600E">CF600E Lomsat gelral</a><br>板子题，分治时维护一个储存每个颜色出现的次数的数组，之后更新时处理答案</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span>  LL;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">1e5</span> + <span class="number">7</span>;</span><br><span class="line"><span class="keyword">int</span> col[maxn], cnt[maxn], fa[maxn], son[maxn], siz[maxn], Son, mxcol;</span><br><span class="line">LL ans[maxn];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> v, nx;</span><br><span class="line">&#125; edge[maxn &lt;&lt; <span class="number">2</span>];</span><br><span class="line"><span class="keyword">int</span> first[maxn], tot = <span class="number">0</span>, n;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">    edge[++ tot] = (Edge) &#123;v, first[u]&#125;;</span><br><span class="line">    first[u] = tot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFS</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> fr)</span> </span>&#123;</span><br><span class="line">    fa[u] = fr; siz[u] = <span class="number">1</span>; son[u] = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = first[u]; i; i = edge[i].nx) &#123;</span><br><span class="line">        <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">        <span class="keyword">if</span>(v == fr) <span class="keyword">continue</span>;</span><br><span class="line">        DFS(v, u);</span><br><span class="line">        siz[u] += siz[v];</span><br><span class="line">        <span class="keyword">if</span>(son[u] == <span class="number">-1</span> || siz[v] &gt; siz[son[u]]) son[u] = v;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">LL res = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Cal</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> tag)</span> </span>&#123;</span><br><span class="line">    cnt[col[u]] += tag;</span><br><span class="line">    <span class="keyword">if</span>(cnt[col[u]] == mxcol) &#123;</span><br><span class="line">        res += col[u];</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(cnt[col[u]] &gt; mxcol) &#123;</span><br><span class="line">        res = col[u];</span><br><span class="line">        mxcol = cnt[col[u]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = first[u]; i; i = edge[i].nx) &#123;</span><br><span class="line">        <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">        <span class="keyword">if</span>(v == fa[u] || v == Son) <span class="keyword">continue</span>;</span><br><span class="line">        Cal(v, tag);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Devide</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">bool</span> del)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = first[u]; i; i = edge[i].nx) &#123;</span><br><span class="line">        <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">        <span class="keyword">if</span>(v == fa[u] || v == son[u]) <span class="keyword">continue</span>;</span><br><span class="line">        Devide(v, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(son[u] != <span class="number">-1</span>) Devide(son[u], <span class="literal">false</span>);</span><br><span class="line">    Son = son[u];</span><br><span class="line">    Cal(u, <span class="number">1</span>);</span><br><span class="line">    ans[u] = res;</span><br><span class="line">    Son = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">if</span>(del) &#123;</span><br><span class="line">        Cal(u, <span class="number">-1</span>);</span><br><span class="line">        mxcol = <span class="number">0</span>;</span><br><span class="line">        res = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++ i) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, col + i);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; ++ i) &#123;</span><br><span class="line">        <span class="keyword">int</span> u, v; <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;u, &amp;v);</span><br><span class="line">        addedge(u, v);</span><br><span class="line">        addedge(v, u);</span><br><span class="line">    &#125;</span><br><span class="line">    DFS(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    Devide(<span class="number">1</span>, <span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++ i) <span class="built_in">printf</span>(<span class="string">&quot;%lld%c&quot;</span>, ans[i], i == n ? <span class="string">&#x27;\n&#x27;</span> : <span class="string">&#x27; &#x27;</span>);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifdef</span> iyua</span></span><br><span class="line">        system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span> </span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/CF570D">CF570D Tree Requests</a><br>首先重排列后能形成回文串的充要条件是，对于出现次数为奇数的字母，最多只有一个，所以维护当前根下，每个深度每种字母出现的次数就可以了</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span>  LL;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">5e5</span> + <span class="number">7</span>;</span><br><span class="line"><span class="keyword">char</span> str[maxn];</span><br><span class="line"><span class="keyword">int</span> first[maxn], n, m, dep[maxn], siz[maxn], son[maxn];</span><br><span class="line"><span class="keyword">int</span> Num[maxn][<span class="number">26</span>], tot;</span><br><span class="line"><span class="keyword">bool</span> yes[maxn];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> v, nx;</span><br><span class="line">&#125; edge[maxn &lt;&lt; <span class="number">1</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">    edge[++ tot] = (Edge) &#123;v, first[u]&#125;;</span><br><span class="line">    first[u] = tot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="built_in">pair</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; &gt; V[maxn];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFS</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> fr)</span> </span>&#123;</span><br><span class="line">    dep[u] = dep[fr] + <span class="number">1</span>;</span><br><span class="line">    siz[u] = <span class="number">1</span>; son[u] = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = first[u]; i; i = edge[i].nx) &#123;</span><br><span class="line">        <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">        DFS(v, u);</span><br><span class="line">        siz[u] += siz[v];</span><br><span class="line">        <span class="keyword">if</span>(son[u] == <span class="number">-1</span> || siz[v] &gt; siz[son[u]]) son[u] = v;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> Son;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Cal</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> tag = <span class="number">1</span>)</span> </span>&#123;</span><br><span class="line">    ++ Num[dep[u]][str[u] - <span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = first[u]; i; i = edge[i].nx) &#123;</span><br><span class="line">        <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">        <span class="keyword">if</span>(v == Son) <span class="keyword">continue</span>;</span><br><span class="line">        Cal(v, tag);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Devide</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">bool</span> del)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = first[u]; i; i = edge[i].nx) &#123;</span><br><span class="line">        <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">        <span class="keyword">if</span>(v == son[u]) <span class="keyword">continue</span>;</span><br><span class="line">        Devide(v, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(son[u] != <span class="number">-1</span>) Devide(son[u], <span class="literal">false</span>);</span><br><span class="line">    Son = son[u];</span><br><span class="line">    Cal(u);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; x : V[u]) &#123;</span><br><span class="line">        <span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; ++ i) cnt += (Num[x.first][i] &amp; <span class="number">1</span>);</span><br><span class="line">        yes[x.second] = (cnt &lt;= <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    Son = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">if</span>(del) &#123;</span><br><span class="line">        Cal(u, <span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n; ++ i) &#123;</span><br><span class="line">        <span class="keyword">int</span> p; <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;p);</span><br><span class="line">        addedge(p, i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, str + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++ i) &#123;</span><br><span class="line">        <span class="keyword">int</span> u, v; <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;u, &amp;v);</span><br><span class="line">        V[u].emplace_back(<span class="built_in">make_pair</span>(v, i));</span><br><span class="line">    &#125;</span><br><span class="line">    DFS(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    Devide(<span class="number">1</span>, <span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++ i) <span class="built_in">puts</span>(yes[i] ? <span class="string">&quot;Yes&quot;</span> : <span class="string">&quot;No&quot;</span>);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifdef</span> iyua</span></span><br><span class="line">        system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span> </span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/CF208E">CF208E Blood Cousins</a><br>首先这题没有卡树上倍增求 $k$ 级祖先，所以不需要写长链剖分<br>然后我们转化一下问题，对于一个点求出和他具有相同 $k$ 级祖先的点的个数，就是等效于求这个点的 $k$ 级祖先有多少个深度和这个点相同的后代 （个数减一）<br>那就很简单了，对于每个询问 $v, p$, 找出 $v$ 的 $p$ 级祖先，配上 $v$ 的深度 $dep[v]$ ，形成一个等价的询问， 之后就很简单了</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span>  LL;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">5e5</span> + <span class="number">7</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> v, nx;</span><br><span class="line">&#125; edge[maxn &lt;&lt; <span class="number">1</span>];</span><br><span class="line"><span class="keyword">int</span> first[maxn], tot = <span class="number">0</span>, n, m;</span><br><span class="line"><span class="keyword">int</span> dep[maxn], siz[maxn], son[maxn], fa[maxn][<span class="number">21</span>];</span><br><span class="line"><span class="keyword">int</span> ans[maxn];</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="built_in">pair</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; &gt; Q[maxn];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">    edge[++ tot] = (Edge) &#123;v, first[u]&#125;;</span><br><span class="line">    first[u] = tot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFS</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> fr)</span> </span>&#123;</span><br><span class="line">    fa[u][<span class="number">0</span>] = fr;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; (<span class="number">1</span> &lt;&lt; i) &lt;= n; ++ i) &#123;</span><br><span class="line">        fa[u][i] = fa[fa[u][i - <span class="number">1</span>]][i - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    dep[u] = dep[fr] + <span class="number">1</span>; siz[u] = <span class="number">1</span>; son[u] = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = first[u]; i; i = edge[i].nx) &#123;</span><br><span class="line">        <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">        DFS(v, u);</span><br><span class="line">        siz[u] += siz[v];</span><br><span class="line">        <span class="keyword">if</span>(son[u] == <span class="number">-1</span> || siz[v] &gt; siz[son[u]]) &#123;</span><br><span class="line">            son[u] = v;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">get</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; (<span class="number">1</span> &lt;&lt; i) &lt;= k; ++ i) &#123;</span><br><span class="line">        <span class="keyword">if</span>((<span class="number">1</span> &lt;&lt; i) &amp; k)</span><br><span class="line">            u = fa[u][i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> u;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> cnt[maxn], Limit;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cal</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> tag = <span class="number">1</span>)</span> </span>&#123;</span><br><span class="line">    cnt[dep[u]] += tag;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = first[u]; i; i = edge[i].nx) &#123;</span><br><span class="line">        <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">        <span class="keyword">if</span>(v == Limit) <span class="keyword">continue</span>;</span><br><span class="line">        cal(v, tag);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Devide</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">bool</span> del)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = first[u]; i; i = edge[i].nx) &#123;</span><br><span class="line">        <span class="keyword">int</span> v = edge[i].v;</span><br><span class="line">        <span class="keyword">if</span>(v == son[u]) <span class="keyword">continue</span>;</span><br><span class="line">        Devide(v, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(son[u] != <span class="number">-1</span>) Devide(son[u], <span class="literal">false</span>);</span><br><span class="line">    Limit = son[u];</span><br><span class="line">    cal(u);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Q[u].size(); ++ i) &#123;</span><br><span class="line">        <span class="keyword">int</span> want = Q[u][i].first, id = Q[u][i].second;</span><br><span class="line">        ans[id] = cnt[want] - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Limit = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">if</span>(del) &#123;</span><br><span class="line">        cal(u, <span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// cout &lt;&lt; (1 &lt;&lt; 20) &lt;&lt; endl;</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++ i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, fa[i]);</span><br><span class="line">        <span class="keyword">if</span>(fa[i][<span class="number">0</span>])</span><br><span class="line">            addedge(fa[i][<span class="number">0</span>], i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++ i) &#123;</span><br><span class="line">        <span class="keyword">if</span>(!fa[i][<span class="number">0</span>]) &#123;</span><br><span class="line">            DFS(i, fa[i][<span class="number">0</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++ i) &#123;</span><br><span class="line">        <span class="keyword">int</span> a, b; <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;a, &amp;b);</span><br><span class="line">        <span class="keyword">if</span>(b &gt;= dep[a]) &#123;</span><br><span class="line">            ans[i] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> lca = get(a, b);</span><br><span class="line">        Q[lca].push_back(<span class="built_in">make_pair</span>(dep[a], i));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++ i) &#123;</span><br><span class="line">        <span class="keyword">if</span>(!fa[i][<span class="number">0</span>]) &#123;</span><br><span class="line">            Devide(i, <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++ i) <span class="built_in">printf</span>(<span class="string">&quot;%d%c&quot;</span>, ans[i], i == m ? <span class="string">&#x27;\n&#x27;</span> : <span class="string">&#x27; &#x27;</span>);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifdef</span> iyua</span></span><br><span class="line">        system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span> </span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/CF246E">CF246E Blood Cousins Return</a><br>一个节点的 $k$ 级儿子，就是他的深度加 $k$的儿子，所以这又转换成了求子树特定深度的贡献的问题，对于字符串可以采用 哈希 或者利用 $STL$ 预处理出每个点的新编号，之后就是常规的算贡献了，关于本质不同的数字算法，就是加为1和减为0时才会变化，所以直接维护每个编号出现的次数就可以了</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="comment">// #include &lt;unordered_map&gt;</span></span><br><span class="line"><span class="comment">// #include &lt;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> de(x)   cerr &lt;&lt; <span class="meta-string">&quot;   debug   &quot;</span> &lt;&lt; #x &lt;&lt; <span class="meta-string">&quot;   ==  &quot;</span> &lt;&lt; x &lt;&lt; endl;</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">1e5</span> + <span class="number">7</span>;</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; arr, V;</span><br><span class="line"><span class="keyword">int</span> id[maxn], n, fa[maxn], nowson;</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; G[maxn];</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="built_in">pair</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; &gt; Q[maxn];</span><br><span class="line"><span class="keyword">int</span> dep[maxn], son[maxn], siz[maxn];</span><br><span class="line"><span class="keyword">int</span> ans[maxn], sum, cnt[maxn];</span><br><span class="line"><span class="built_in">unordered_map</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; ST[maxn];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFS1</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">    son[u] = <span class="number">-1</span>, siz[u] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G[u].size(); ++ i) &#123;</span><br><span class="line">        <span class="keyword">int</span> v = G[u][i];</span><br><span class="line">        dep[v] = dep[u] + <span class="number">1</span>;</span><br><span class="line">        DFS1(v);</span><br><span class="line">        siz[u] += siz[v];</span><br><span class="line">        <span class="keyword">if</span>(son[u] == <span class="number">-1</span> || siz[v] &gt; siz[son[u]]) &#123;</span><br><span class="line">            son[u] = v;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cal</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> tag, <span class="keyword">int</span> fr)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// if(fr != u) &#123;</span></span><br><span class="line">        <span class="keyword">if</span>(tag &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            ST[dep[u]][id[u]] ++;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            ST[dep[u]][id[u]] --;</span><br><span class="line">            <span class="keyword">if</span>(ST[dep[u]][id[u]] == <span class="number">0</span>) &#123;</span><br><span class="line">                ST[dep[u]].erase(ST[dep[u]].find(id[u]));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G[u].size(); ++ i) &#123;</span><br><span class="line">        <span class="keyword">int</span> v = G[u][i];</span><br><span class="line">        <span class="keyword">if</span>(v == nowson) <span class="keyword">continue</span>;</span><br><span class="line">        cal(v, tag, u);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFS</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">bool</span> del)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// set&lt;int&gt; a;</span></span><br><span class="line">    <span class="comment">// a.erase(1);</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G[u].size(); ++ i) &#123;</span><br><span class="line">        <span class="keyword">int</span> v = G[u][i];</span><br><span class="line">        <span class="keyword">if</span>(v == son[u]) <span class="keyword">continue</span>;</span><br><span class="line">        DFS(v, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(son[u] != <span class="number">-1</span>) &#123;</span><br><span class="line">        DFS(son[u], <span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    nowson = son[u];</span><br><span class="line">    cal(u, <span class="number">1</span>, u);</span><br><span class="line">    nowson = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Q[u].size(); ++ i) &#123;</span><br><span class="line">        <span class="keyword">int</span> v = Q[u][i].first, id = Q[u][i].second;</span><br><span class="line">        <span class="comment">// de(id)</span></span><br><span class="line">        <span class="comment">// de(v)</span></span><br><span class="line">        v += dep[u];</span><br><span class="line">        <span class="keyword">if</span>(ST[v].size()) &#123;</span><br><span class="line">            ans[id] = ST[v].size();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            ans[id] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(del) &#123;</span><br><span class="line">        cal(u, <span class="number">-1</span>, u);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> rt[maxn];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="built_in">cin</span>.tie(<span class="number">0</span>), <span class="built_in">cout</span>.tie(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n;</span><br><span class="line">    <span class="keyword">int</span> root;</span><br><span class="line">    rt[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    arr.resize(n); V.resize(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++ i) &#123;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; arr[i] &gt;&gt; fa[i];</span><br><span class="line">        V[i] = arr[i];</span><br><span class="line">        <span class="keyword">if</span>(fa[i]) &#123;</span><br><span class="line">            G[fa[i]].push_back(i + <span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> rt[++ rt[<span class="number">0</span>]] = i + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    sort(V.begin(), V.end());</span><br><span class="line">    V.resize(unique(V.begin(), V.end()) - V.begin());</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++ i) &#123;</span><br><span class="line">        id[i + <span class="number">1</span>] = lower_bound(V.begin(), V.end(), arr[i]) - V.begin() + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= rt[<span class="number">0</span>]; ++ i)   DFS1(rt[i]);</span><br><span class="line">    <span class="keyword">int</span> m; <span class="built_in">cin</span> &gt;&gt; m;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++ i) &#123;</span><br><span class="line">        <span class="keyword">int</span> x, k; <span class="built_in">cin</span> &gt;&gt; x &gt;&gt; k;</span><br><span class="line">        Q[x].push_back(<span class="built_in">make_pair</span>(k, i));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= rt[<span class="number">0</span>]; ++ i) DFS(rt[i], <span class="literal">true</span>);</span><br><span class="line">    <span class="comment">// DFS(root, false);</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++ i) <span class="built_in">cout</span> &lt;&lt; ans[i] &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifdef</span> iyua</span></span><br><span class="line">        system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span> </span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/CF1009F">CF1009F Dominant Indices</a><br>人话翻译，对于一个根，找出后代中，每一种深度后代数目最多的同时深度最小的那个深度<br>维护下每个深度出现的次数，然后贪心向小选取就可以了</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> de(x)   cerr &lt;&lt; <span class="meta-string">&quot;   debug   &quot;</span> &lt;&lt; #x &lt;&lt; <span class="meta-string">&quot;   ==   &quot;</span> &lt;&lt; x &lt;&lt; endl;</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">1e6</span> + <span class="number">7</span>;</span><br><span class="line"><span class="keyword">int</span> cnt[maxn], mxcnt, pos, n, ans[maxn], dep[maxn];</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; G[maxn];</span><br><span class="line"><span class="keyword">int</span> siz[maxn], son[maxn], nowson;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFS1</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> fr)</span> </span>&#123;</span><br><span class="line">    siz[u] = <span class="number">1</span>, son[u] = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G[u].size(); ++ i) &#123;</span><br><span class="line">        <span class="keyword">int</span> v = G[u][i];</span><br><span class="line">        <span class="keyword">if</span>(v == fr) <span class="keyword">continue</span>;</span><br><span class="line">        dep[v] = dep[u] + <span class="number">1</span>;</span><br><span class="line">        DFS1(v, u);</span><br><span class="line">        siz[u] += siz[v];</span><br><span class="line">        <span class="keyword">if</span>(son[u] == <span class="number">-1</span> || siz[v] &gt; siz[son[u]]) &#123;</span><br><span class="line">            son[u] = v;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cal</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> fr, <span class="keyword">int</span> tag)</span> </span>&#123;</span><br><span class="line">    cnt[dep[u]] += tag;</span><br><span class="line">    <span class="keyword">if</span>(cnt[dep[u]] &gt; mxcnt) &#123;</span><br><span class="line">        mxcnt = cnt[dep[u]];</span><br><span class="line">        pos = dep[u];</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(cnt[dep[u]] == mxcnt) &#123;</span><br><span class="line">        pos = min(pos, dep[u]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G[u].size(); ++ i) &#123;</span><br><span class="line">        <span class="keyword">int</span> v = G[u][i];</span><br><span class="line">        <span class="keyword">if</span>(v == fr || v == nowson) <span class="keyword">continue</span>;</span><br><span class="line">        cal(v, u, tag);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFS</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> fr, <span class="keyword">bool</span> del)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G[u].size(); ++ i) &#123;</span><br><span class="line">        <span class="keyword">int</span> v = G[u][i];</span><br><span class="line">        <span class="keyword">if</span>(v == fr || v == son[u]) <span class="keyword">continue</span>;</span><br><span class="line">        DFS(v, u, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(son[u] != <span class="number">-1</span>) DFS(son[u], u, <span class="literal">false</span>);</span><br><span class="line">    nowson = son[u];</span><br><span class="line">    cal(u, fr, <span class="number">1</span>);</span><br><span class="line">    ans[u] = pos;</span><br><span class="line">    nowson = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(del) &#123;</span><br><span class="line">        cal(u, fr, <span class="number">-1</span>);</span><br><span class="line">        mxcnt = <span class="number">0</span>;</span><br><span class="line">        pos = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    pos = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; ++ i) &#123;</span><br><span class="line">        <span class="keyword">int</span> u, v; <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;u, &amp;v);</span><br><span class="line">        G[u].push_back(v);</span><br><span class="line">        G[v].push_back(u);</span><br><span class="line">    &#125;</span><br><span class="line">    dep[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    DFS1(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    DFS(<span class="number">1</span>, <span class="number">0</span>, <span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++ i) <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, ans[i] - dep[i]);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifdef</span> iyua</span></span><br><span class="line">        system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span> </span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/CF375D">CF375D Tree and Queries</a><br>维护当前每个颜色出现的次数，以及每种次数出现的次数就可以了</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> de(x)   cerr &lt;&lt; <span class="meta-string">&quot;   debug   &quot;</span> &lt;&lt; #x &lt;&lt; <span class="meta-string">&quot;   ==   &quot;</span> &lt;&lt; x &lt;&lt; endl;</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">1e6</span> + <span class="number">7</span>;</span><br><span class="line"><span class="keyword">int</span> cnt[maxn], n, m, col[maxn], nowson;</span><br><span class="line"><span class="comment">// cnt -colcnt</span></span><br><span class="line"><span class="comment">// res -cntans</span></span><br><span class="line"><span class="comment">// ans -kthans</span></span><br><span class="line"><span class="keyword">int</span> res[maxn], sum, siz[maxn], son[maxn], ans[maxn];</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; G[maxn];</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="built_in">pair</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; &gt; Q[maxn];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFS1</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> fr)</span> </span>&#123;</span><br><span class="line">    siz[u] = <span class="number">1</span>, son[u] = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G[u].size(); ++ i) &#123;</span><br><span class="line">        <span class="keyword">int</span> v = G[u][i];</span><br><span class="line">        <span class="keyword">if</span>(v == fr) <span class="keyword">continue</span>;</span><br><span class="line">        DFS1(v, u);</span><br><span class="line">        siz[u] += siz[v];</span><br><span class="line">        <span class="keyword">if</span>(son[u] == <span class="number">-1</span> || siz[v] &gt; siz[son[u]]) &#123;</span><br><span class="line">            son[u] = v;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cal</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> fr, <span class="keyword">int</span> tag)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(tag &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        ++ cnt[col[u]];</span><br><span class="line">        ++ res[cnt[col[u]]];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        -- res[cnt[col[u]]];</span><br><span class="line">        -- cnt[col[u]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G[u].size(); ++ i) &#123;</span><br><span class="line">        <span class="keyword">int</span> v = G[u][i];</span><br><span class="line">        <span class="keyword">if</span>(v == fr || v == nowson) <span class="keyword">continue</span>;</span><br><span class="line">        cal(v, u, tag);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFS</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> fr, <span class="keyword">bool</span> del)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G[u].size(); ++ i) &#123;</span><br><span class="line">        <span class="keyword">int</span> v = G[u][i];</span><br><span class="line">        <span class="keyword">if</span>(v == fr || v == son[u]) <span class="keyword">continue</span>;</span><br><span class="line">        DFS(v, u, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(son[u] != <span class="number">-1</span>) DFS(son[u], u, <span class="literal">false</span>);</span><br><span class="line">    nowson = son[u];</span><br><span class="line">    cal(u, fr, <span class="number">1</span>);</span><br><span class="line">    nowson = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Q[u].size(); ++ i) &#123;</span><br><span class="line">        <span class="keyword">int</span> v = Q[u][i].first, id = Q[u][i].second;</span><br><span class="line">        ans[id] = res[v];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(del) &#123;</span><br><span class="line">        cal(u, fr, <span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++ i) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;col[i]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; ++ i) &#123;</span><br><span class="line">        <span class="keyword">int</span> u, v; <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;u, &amp;v);</span><br><span class="line">        G[u].push_back(v);</span><br><span class="line">        G[v].push_back(u);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++ i) &#123;</span><br><span class="line">        <span class="keyword">int</span> x, k; <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;x, &amp;k);</span><br><span class="line">        Q[x].push_back(<span class="built_in">make_pair</span>(k, i));</span><br><span class="line">    &#125;</span><br><span class="line">    nowson = <span class="number">0</span>;</span><br><span class="line">    DFS1(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    DFS(<span class="number">1</span>, <span class="number">0</span>, <span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++ i) <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, ans[i]);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifdef</span> iyua</span></span><br><span class="line">        system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span> </span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" rel="tag">数据结构</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
    <article id="post-珂朵莉树" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a  href="../../2021/01/17/%E7%8F%82%E6%9C%B5%E8%8E%89%E6%A0%91/" class="article-date">
      <time datetime="2021-01-17T11:41:57.000Z" itemprop="datePublished">2021-01-17</time>
</a>

    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a  class="article-title" href="../../2021/01/17/%E7%8F%82%E6%9C%B5%E8%8E%89%E6%A0%91/">珂朵莉树</a>
    </h1>
  


      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>我人傻了…这个玩意也太暴力了<br>学习珂朵莉树只需要如下基础</p>
<ol>
<li>STL中set的简单应用</li>
<li>会暴力</li>
<li>数学（如果你想证明它的复杂度的话）</li>
</ol>
<p>没了，对没了！只需要会这些<br>第三点无关紧要<br>要求是数据具有 <strong>随机性</strong> , <strong>区间推平操作</strong>  ,<strong>区间01反转</strong><br>如果数据不是随机的话不要轻易尝试珂朵莉树….轻轻松松卡到无限 $TLE$<br>一个区间可以用左右端点来表示，所以我们用一个结构体表示点来维护一个区间<br>常用宏</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SIT		set<span class="meta-string">&lt;Node&gt;::iterator</span></span></span><br></pre></td></tr></table></figure>
<p>关于建树</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">	<span class="comment">// 左端点 右端点  权值</span></span><br><span class="line">	<span class="keyword">int</span> l, r；</span><br><span class="line">    <span class="keyword">mutable</span> <span class="keyword">int</span> val; <span class="comment">// 注意这里是mutable 类型,使得可以使用迭代器来修改这个值</span></span><br><span class="line">	<span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Node&amp; B) <span class="keyword">const</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> l &lt; B.l;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">set</span>&lt;Node&gt; Tree;</span><br></pre></td></tr></table></figure>
<p>嗯，，就这么点<br>我们将原序列中连续的一段值相同区间用一个点表示，假如 $l$ 到 $r$ 全是 $x$， 只需一个节点就可以表示</p>
<p>利用 $split$ 函数来分割出一个端点</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">SIT <span class="title">split</span><span class="params">(LL pos)</span> </span>&#123;</span><br><span class="line">    SIT it = Tree.lower_bound(Node(pos));</span><br><span class="line">    <span class="keyword">if</span>(it != Tree.end() &amp;&amp; it -&gt; l == pos) <span class="keyword">return</span> it;</span><br><span class="line">    -- it;</span><br><span class="line">    LL l = it -&gt; l, r = it -&gt; r;</span><br><span class="line">    <span class="keyword">int</span> val = it -&gt; val;</span><br><span class="line">    Tree.erase(it);</span><br><span class="line">    Tree.insert(Node(l, pos - <span class="number">1</span>, val));</span><br><span class="line">    <span class="keyword">return</span> Tree.insert(Node(pos, r, val)).first;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意 $set$ 的 $insert$ 操作会返回一个 $pair$ 类型的值，第一关键字是新插入的地址，第二关键字是 $bool$类型的代表是否插入成功<br>$Assign$ 函数是区间赋值，分离端点后暴力更新就可以了</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Assign</span><span class="params">(LL l, LL r, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">    SIT pos2 = split(r + <span class="number">1</span>), pos1 = split(l);</span><br><span class="line">    Tree.erase(pos1, pos2);</span><br><span class="line">    Tree.insert(Node(l, r, val));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>总之所有操作基本都是暴力…<br>上例题<br><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/CF896C">CF896C</a><br>区间加就是利用迭代器暴力修改，区间推平直接建立新结点，区间 $kth$就存下来所有值，排个序从小到大减去每个的个数暴力寻找….区间求幂也是直接暴力。。。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> de(x)   cerr &lt;&lt; <span class="meta-string">&quot;  debug  &quot;</span> &lt;&lt; #x &lt;&lt; <span class="meta-string">&quot;  ==  &quot;</span> &lt;&lt; x &lt;&lt; endl;</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">1e5</span> + <span class="number">7</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span>  LL;</span><br><span class="line"><span class="keyword">const</span> LL mod = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SIT     set<span class="meta-string">&lt;node&gt;::iterator</span></span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> l, r;</span><br><span class="line">    <span class="keyword">mutable</span> LL val; <span class="comment">// mutable突破 const限制  使得迭代器中可修改他</span></span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> node&amp; B) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> l &lt; B.l;</span><br><span class="line">    &#125;</span><br><span class="line">    node(<span class="keyword">int</span> _l, <span class="keyword">int</span> _r, LL _val) : l(_l), r(_r), val(_val) &#123;&#125;</span><br><span class="line">    node(<span class="keyword">int</span> _l) : l(_l) &#123;&#125; <span class="comment">// split 专用</span></span><br><span class="line">&#125;; </span><br><span class="line"><span class="built_in">set</span>&lt;node&gt; Tree;</span><br><span class="line"><span class="function">SIT <span class="title">Split</span><span class="params">(<span class="keyword">int</span> pos)</span> </span>&#123;</span><br><span class="line">    SIT it = Tree.lower_bound(node(pos));</span><br><span class="line">    <span class="keyword">if</span>(it != Tree.end() &amp;&amp; it -&gt; l == pos) <span class="keyword">return</span> it;</span><br><span class="line">    -- it;</span><br><span class="line">    <span class="keyword">int</span> l = it -&gt; l, r = it -&gt; r;</span><br><span class="line">    LL  val = it -&gt; val;</span><br><span class="line">    Tree.erase(it);</span><br><span class="line">    Tree.insert(node(l, pos - <span class="number">1</span>, val));</span><br><span class="line">    <span class="keyword">return</span> Tree.insert(node(pos, r, val)).first;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Assign</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, LL x)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 先R后L  因为每次split可能会删它左边的一个点，先L后R可能L会失效</span></span><br><span class="line">    SIT R = Split(r + <span class="number">1</span>), L = Split(l);</span><br><span class="line">    Tree.erase(L, R);</span><br><span class="line">    Tree.insert(node(l, r, x));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Add</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, LL x)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 先R后L  因为每次split可能会删它左边的一个点，先L后R可能L会失效</span></span><br><span class="line">    SIT R = Split(r + <span class="number">1</span>), L = Split(l);</span><br><span class="line">    <span class="keyword">while</span>(L != R) &#123;</span><br><span class="line">        L -&gt; val += x;</span><br><span class="line">        ++ L;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> n, m;</span><br><span class="line">LL Seed, Vmax, V[maxn];</span><br><span class="line"><span class="function">LL <span class="title">Rand</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    LL tmp = Seed;</span><br><span class="line">    Seed = (Seed * <span class="number">7</span> + <span class="number">13</span>) % mod;</span><br><span class="line">    <span class="keyword">return</span> tmp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">LL <span class="title">qpow</span><span class="params">(LL x, LL c, <span class="keyword">const</span> LL md)</span> </span>&#123;</span><br><span class="line">    x %= md;</span><br><span class="line">    LL res = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(c) &#123;</span><br><span class="line">        <span class="keyword">if</span>(c &amp; <span class="number">1</span>) res = (res * x) % md;</span><br><span class="line">        c &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">        x = (x * x) % md;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">NODE</span> &#123;</span></span><br><span class="line">    LL x, cnt;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> NODE&amp; B) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> x &lt; B.x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">vector</span>&lt;NODE&gt; vec;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">KTH</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, LL k)</span> </span>&#123;</span><br><span class="line">    vec.clear();</span><br><span class="line">    SIT pos2 = Split(r + <span class="number">1</span>), pos1 = Split(l);</span><br><span class="line">    <span class="keyword">while</span>(pos1 != pos2) &#123;</span><br><span class="line">        vec.push_back((NODE) &#123;pos1 -&gt; val, pos1 -&gt; r - pos1 -&gt; l + <span class="number">1</span>&#125;);</span><br><span class="line">        ++ pos1;</span><br><span class="line">    &#125;</span><br><span class="line">    sort(vec.begin(), vec.end());</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; vec.size(); ++ i) &#123;</span><br><span class="line">        k -= vec[i].cnt;</span><br><span class="line">        <span class="keyword">if</span>(k &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, vec[i].x);</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">POW</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, LL x, <span class="keyword">const</span> LL y)</span> </span>&#123;</span><br><span class="line">    LL res = <span class="number">0</span>;</span><br><span class="line">    SIT pos2 = Split(r + <span class="number">1</span>), pos1 = Split(l);</span><br><span class="line">    <span class="keyword">while</span>(pos1 != pos2) &#123;</span><br><span class="line">        res = (res + (pos1 -&gt; r - pos1 -&gt; l + <span class="number">1</span>) % y * qpow(pos1 -&gt; val, x, y) % y) % y;</span><br><span class="line">        ++ pos1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, res);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d %lld %lld&quot;</span>, &amp;n, &amp;m, &amp;Seed, &amp;Vmax);</span><br><span class="line">    <span class="keyword">int</span> l = <span class="number">1</span>;</span><br><span class="line">    LL last;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++ i) &#123;</span><br><span class="line">        V[i] = Rand() % Vmax + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(i == <span class="number">1</span>) &#123;</span><br><span class="line">            last = V[i];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(last != V[i]) &#123;</span><br><span class="line">                Tree.insert(node(l, i - <span class="number">1</span>, last));</span><br><span class="line">                last = V[i];</span><br><span class="line">                l = i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(i == n) Tree.insert(node(l, i, last));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(m --) &#123;</span><br><span class="line">        <span class="keyword">int</span> op = Rand() % <span class="number">4</span> + <span class="number">1</span>;</span><br><span class="line">         l = Rand() % n + <span class="number">1</span>;</span><br><span class="line">         <span class="keyword">int</span>  r = Rand() % n + <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// de(op)</span></span><br><span class="line">        <span class="comment">// de(l)</span></span><br><span class="line">        <span class="comment">// de(r)</span></span><br><span class="line">        LL x, y;</span><br><span class="line">        <span class="keyword">if</span>(l &gt; r) swap(l, r);</span><br><span class="line">        <span class="keyword">if</span>(op == <span class="number">3</span>) &#123;</span><br><span class="line">            x = Rand() % (r - l + <span class="number">1</span>) + <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            x = Rand() % Vmax + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(op == <span class="number">4</span>) &#123;</span><br><span class="line">            y = Rand() % Vmax + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// de(op)</span></span><br><span class="line">        <span class="comment">// de(l)</span></span><br><span class="line">        <span class="comment">// de(r)</span></span><br><span class="line">        <span class="comment">// de(x)</span></span><br><span class="line">        <span class="comment">// de(y)</span></span><br><span class="line">        <span class="keyword">if</span>(op == <span class="number">1</span>) &#123;</span><br><span class="line">            Add(l, r, x);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(op == <span class="number">2</span>) &#123;</span><br><span class="line">            Assign(l, r, x);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(op == <span class="number">3</span>) &#123;</span><br><span class="line">            KTH(l, r, x);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(op == <span class="number">4</span>) &#123;</span><br><span class="line">            POW(l, r, x, y);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifdef</span> iyua</span></span><br><span class="line">        system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span> </span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://ac.nowcoder.com/acm/problem/20279">SCOI2010</a><br>洛谷上不可过，数据加强了，牛客上可以<br>操作0，1常规操作，操作2暴力取反，操作3，4暴力寻找…<br>全是暴力</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> de(x)   cerr &lt;&lt; <span class="meta-string">&quot;  debug  &quot;</span> &lt;&lt; #x &lt;&lt; <span class="meta-string">&quot;  ==  &quot;</span> &lt;&lt; x &lt;&lt; endl;</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">1e5</span> + <span class="number">7</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SIT     set<span class="meta-string">&lt;node&gt;::iterator</span></span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> l, r;</span><br><span class="line">    <span class="keyword">mutable</span> <span class="keyword">int</span> val; <span class="comment">// mutable突破 const限制  使得迭代器中可修改他</span></span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> node&amp; B) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> l &lt; B.l;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;; </span><br><span class="line"><span class="built_in">set</span>&lt;node&gt; Tree;</span><br><span class="line"><span class="function">SIT <span class="title">Split</span><span class="params">(<span class="keyword">int</span> pos)</span> </span>&#123;</span><br><span class="line">    SIT it = Tree.lower_bound((node)&#123;pos, <span class="number">0</span>, <span class="number">0</span>&#125;);</span><br><span class="line">    <span class="keyword">if</span>(it != Tree.end() &amp;&amp; it -&gt; l == pos) <span class="keyword">return</span> it;</span><br><span class="line">    -- it;</span><br><span class="line">    <span class="keyword">int</span> l = it -&gt; l, r = it -&gt; r, val = it -&gt; val;</span><br><span class="line">    Tree.erase(it);</span><br><span class="line">    Tree.insert((node) &#123;l, pos - <span class="number">1</span>, val&#125;);</span><br><span class="line">    <span class="keyword">return</span> Tree.insert((node) &#123;pos, r, val&#125;).first;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Assign</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 先R后L  因为每次split可能会删它左边的一个点，先L后R可能L会失效</span></span><br><span class="line">    SIT R = Split(r + <span class="number">1</span>), L = Split(l);</span><br><span class="line">    Tree.erase(L, R);</span><br><span class="line">    Tree.insert((node) &#123;l, r, x&#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Rev</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">    SIT pos1 = Split(r + <span class="number">1</span>), pos2 = Split(l);</span><br><span class="line">    <span class="keyword">while</span>(pos2 != pos1) &#123;</span><br><span class="line">        pos2 -&gt; val = <span class="number">1</span> - pos2 -&gt; val;</span><br><span class="line">        ++ pos2;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">cal</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line">    SIT pos1 = Split(r + <span class="number">1</span>), pos2 = Split(l);</span><br><span class="line">    <span class="keyword">while</span>(pos2 != pos1) &#123;</span><br><span class="line">        res += (pos2 -&gt; r - pos2 -&gt; l + <span class="number">1</span>) * (pos2 -&gt; val);</span><br><span class="line">        ++ pos2;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">check</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> res = <span class="number">0</span>, tmp = <span class="number">0</span>;</span><br><span class="line">    SIT pos1 = Split(r + <span class="number">1</span>), pos2 = Split(l);</span><br><span class="line">    <span class="keyword">while</span>(pos2 != pos1) &#123;</span><br><span class="line">        <span class="keyword">if</span>(pos2 -&gt; val) &#123;</span><br><span class="line">            tmp += (pos2 -&gt; r - pos2 -&gt; l + <span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> tmp = <span class="number">0</span>;</span><br><span class="line">        ++ pos2;</span><br><span class="line">        res = max(res, tmp);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n, Q; <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;n, &amp;Q);</span><br><span class="line">    <span class="keyword">int</span> l = <span class="number">1</span>, r, last;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++ i) &#123;</span><br><span class="line">        <span class="keyword">int</span> x; <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;x);</span><br><span class="line">        <span class="keyword">if</span>(i == <span class="number">1</span>) &#123;</span><br><span class="line">            last = x;</span><br><span class="line">            r = i;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(x == last) &#123;</span><br><span class="line">                r = i;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                Tree.insert((node)&#123;l, i - <span class="number">1</span>, last&#125;);</span><br><span class="line">                last = x;</span><br><span class="line">                l = r = i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(i == n) &#123;</span><br><span class="line">            Tree.insert((node)&#123;l, r, last&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(Q --) &#123;</span><br><span class="line">        <span class="keyword">int</span> op, l, r;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d %d %d&quot;</span>, &amp;op, &amp;l, &amp;r);</span><br><span class="line">        ++ l, ++ r;</span><br><span class="line">        <span class="keyword">if</span>(op == <span class="number">0</span>) &#123;</span><br><span class="line">            Assign(l, r, <span class="number">0</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(op == <span class="number">1</span>) &#123;</span><br><span class="line">            Assign(l, r, <span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(op == <span class="number">2</span>) &#123;</span><br><span class="line">            Rev(l, r);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(op == <span class="number">3</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, cal(l, r));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, check(l, r));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifdef</span> iyua</span></span><br><span class="line">        system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span> </span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/CF817F">CF817F</a><br>仔细读读就能发现，题目所说的添加删除就是区间推平为1或者0的意思<br>操作三就是区间反转的意思，每次找出第一个为0的位置就可以了<br>找 $mex$ 当然是暴力找<br>需要初始化成区间 $1$ 到 $1e18 + 1$ 全是0的一个节点，然后就是常规操作了….</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> de(x)   cerr &lt;&lt; <span class="meta-string">&quot;  debug  &quot;</span> &lt;&lt; #x &lt;&lt; <span class="meta-string">&quot;  ==  &quot;</span> &lt;&lt; x &lt;&lt; endl;</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span>   LL;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SIT     set<span class="meta-string">&lt;Node&gt;::iterator </span></span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">    LL l, r;</span><br><span class="line">    <span class="keyword">mutable</span> <span class="keyword">int</span> val;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Node&amp; B) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> l &lt; B.l;</span><br><span class="line">    &#125;</span><br><span class="line">    Node(LL _l, LL _r, <span class="keyword">int</span> _val) :</span><br><span class="line">        l(_l), r(_r), val(_val) &#123;&#125;</span><br><span class="line">    Node(LL _l) : l(_l) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">set</span>&lt;Node&gt; Tree;</span><br><span class="line"><span class="function">SIT <span class="title">split</span><span class="params">(LL pos)</span> </span>&#123;</span><br><span class="line">    SIT it = Tree.lower_bound(Node(pos));</span><br><span class="line">    <span class="keyword">if</span>(it != Tree.end() &amp;&amp; it -&gt; l == pos) <span class="keyword">return</span> it;</span><br><span class="line">    -- it;</span><br><span class="line">    LL l = it -&gt; l, r = it -&gt; r;</span><br><span class="line">    <span class="keyword">int</span> val = it -&gt; val;</span><br><span class="line">    Tree.erase(it);</span><br><span class="line">    Tree.insert(Node(l, pos - <span class="number">1</span>, val));</span><br><span class="line">    <span class="keyword">return</span> Tree.insert(Node(pos, r, val)).first;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Assign</span><span class="params">(LL l, LL r, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">    SIT pos2 = split(r + <span class="number">1</span>), pos1 = split(l);</span><br><span class="line">    Tree.erase(pos1, pos2);</span><br><span class="line">    Tree.insert(Node(l, r, val));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Rev</span><span class="params">(LL l, LL r)</span> </span>&#123;</span><br><span class="line">    SIT pos2 = split(r + <span class="number">1</span>), pos1 = split(l);</span><br><span class="line">    <span class="keyword">while</span>(pos1 != pos2) &#123;</span><br><span class="line">        pos1 -&gt; val = <span class="number">1</span> - pos1 -&gt; val;</span><br><span class="line">        ++ pos1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; x : Tree) &#123;</span><br><span class="line">        <span class="keyword">if</span>(x.val == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, x.l);</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    Tree.insert(Node(<span class="number">1</span>, <span class="number">1e18</span> + <span class="number">1</span>, <span class="number">0</span>));</span><br><span class="line">    <span class="keyword">while</span>(n --) &#123;</span><br><span class="line">        <span class="keyword">int</span> op;</span><br><span class="line">        LL l, r;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d %lld %lld&quot;</span>, &amp;op, &amp;l, &amp;r);</span><br><span class="line">        <span class="keyword">if</span>(op == <span class="number">1</span>) &#123;</span><br><span class="line">            Assign(l, r, <span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(op == <span class="number">2</span>) &#123;</span><br><span class="line">            Assign(l, r, <span class="number">0</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Rev(l, r);</span><br><span class="line">        &#125;</span><br><span class="line">        Print();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">ifdef</span> iyua</span></span><br><span class="line">        system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span> </span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" rel="tag">数据结构</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="../2/">&amp;laquo; Prev</a><a class="page-number" href="../../">1</a><a class="page-number" href="../2/">2</a><span class="page-number current">3</span><a class="page-number" href="../4/">4</a><a class="page-number" href="../5/">5</a><a class="page-number" href="../6/">6</a><a class="extend next" rel="next" href="../4/">Next &amp;raquo;</a>
    </nav>
  

</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                &copy; 2021 iyua
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank">Hexo &nbsp;&nbsp;</a><a href="https://github.com/maochunguang" target="_blank">Blog</a> by tommy
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" >极客到访数: 
                            <span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>, </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit">本页阅读量: 
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>

    </div>
    
<script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>


<script src="../../js/main.js"></script>


    <script>
        $(document).ready(function() {
            var backgroundnum = 1;
            var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
            $("#mobile-nav").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
            $(".left-col").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
        })
    </script>


<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'xxxxx', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->



	<script>
	var _hmt = _hmt || [];
	(function() {
	  var hm = document.createElement("script");
	  hm.src = "//hm.baidu.com/hm.js?xxxxxx";
	  var s = document.getElementsByTagName("script")[0]; 
	  s.parentNode.insertBefore(hm, s);
	})();
	</script>



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<div class="scroll" id="scroll">
    <a href="#"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments"><i class="fa fa-comments-o"></i></a>
    <a href="#footer"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    $(document).ready(function() {
        if ($("#comments").length < 1) {
            $("#scroll > a:nth-child(2)").hide();
        };
    })
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

  <script language="javascript">
    $(function() {
        $("a[title]").each(function() {
            var a = $(this);
            var title = a.attr('title');
            if (title == undefined || title == "") return;
            a.data('title', title).removeAttr('title').hover(
            function() {
                var offset = a.offset();
                $("<div id=\"anchortitlecontainer\"></div>").appendTo($("body")).html(title).css({
                    top: offset.top - a.outerHeight() - 15,
                    left: offset.left + a.outerWidth()/2 + 1
                }).fadeIn(function() {
                    var pop = $(this);
                    setTimeout(function() {
                        pop.remove();
                    }, pop.text().length * 800);
                });
            }, function() {
                $("#anchortitlecontainer").remove();
            });
        });
    });
</script>


  </div>
</body>
</html>